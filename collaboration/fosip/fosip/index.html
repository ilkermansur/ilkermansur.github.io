
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ilkermansur.github.io/collaboration/fosip/fosip/">
      
      
        <link rel="prev" href="../../clica/cucm_imp_integration/">
      
      
        <link rel="next" href="../../icms/cms/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Fundamental of SIP - Ilker Mansur Homepage</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Source Code Pro"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sip-components" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Ilker Mansur Homepage" class="md-header__button md-logo" aria-label="Ilker Mansur Homepage" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.202.798C5.016.798 0 5.814 0 12s5.016 11.202 11.202 11.202c1.094 0 2.153-.157 3.154-.45v-5.335a6.27 6.27 0 1 1 0-10.839v-5.33c-1-.293-2.057-.45-3.154-.45m3.375 6.343v4.304h5.27L24 7.14Zm-.037 5.377v4.304h9.423l-4.156-4.304z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ilker Mansur Homepage
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Fundamental of SIP
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="yellow"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ilkermansur" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ilkermansur
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Ilker Mansur Homepage" class="md-nav__button md-logo" aria-label="Ilker Mansur Homepage" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.202.798C5.016.798 0 5.814 0 12s5.016 11.202 11.202 11.202c1.094 0 2.153-.157 3.154-.45v-5.335a6.27 6.27 0 1 1 0-10.839v-5.33c-1-.293-2.057-.45-3.154-.45m3.375 6.343v4.304h5.27L24 7.14Zm-.037 5.377v4.304h9.423l-4.156-4.304z"/></svg>

    </a>
    Ilker Mansur Homepage
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ilkermansur" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ilkermansur
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HomePage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Collaboration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Collaboration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Collaboration Automation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Collaboration Automation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clauto/clauto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CUCM Automation (clauto)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Collaboration Apps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Collaboration Apps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clica/cucm_cuc_integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cucm Unity Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clica/cucm_exp_integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cucm Expressway Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../clica/cucm_imp_integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cucm Presence Integration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Sip
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Sip
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Fundamental of SIP
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Fundamental of SIP
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sip-components" class="md-nav__link">
    <span class="md-ellipsis">
      SIP Components
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-sip-call-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Basic SIP Call Flow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wireshark-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Wireshark Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rtp-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      RTP Analysis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sip-methods-and-headers" class="md-nav__link">
    <span class="md-ellipsis">
      SIP Methods and Headers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dtmf" class="md-nav__link">
    <span class="md-ellipsis">
      DTMF
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ios-devices-and-sip" class="md-nav__link">
    <span class="md-ellipsis">
      IOS Devices and SIP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nat-in-sip" class="md-nav__link">
    <span class="md-ellipsis">
      NAT in SIP
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cisco Meeting Server
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Cisco Meeting Server
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../icms/cms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CMS Basic Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../icms/cms_db_cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CMS DB Cluster
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contact Center
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Contact Center
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../uccxd/uccxd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact Center Express
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sip-components" class="md-nav__link">
    <span class="md-ellipsis">
      SIP Components
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-sip-call-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Basic SIP Call Flow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wireshark-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Wireshark Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rtp-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      RTP Analysis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sip-methods-and-headers" class="md-nav__link">
    <span class="md-ellipsis">
      SIP Methods and Headers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dtmf" class="md-nav__link">
    <span class="md-ellipsis">
      DTMF
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ios-devices-and-sip" class="md-nav__link">
    <span class="md-ellipsis">
      IOS Devices and SIP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nat-in-sip" class="md-nav__link">
    <span class="md-ellipsis">
      NAT in SIP
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Fundamental of SIP</h1>

<p><strong>FoSIP</strong></p>
<ul>
<li>
<p>[x] SIP is a signaling protocol used to <code>create</code>, <code>modify</code>, and <code>terminate</code> a multimedia session over the Internet Protocol. A session could be established between two endpoints or more. An endpoint can be a smartphone, a laptop, or any device that can receive and send multimedia content over the Internet.</p>
</li>
<li>
<p>[x] SIP is an application layer protocol defined by IETF (Internet Engineering Task Force) standard. It is
defined in <a href="https://datatracker.ietf.org/doc/html/rfc3261">RFC 3261</a>. (june 2002)</p>
</li>
<li>
<p>[x] SIPembodies client-server architecture and the use of URI from HTTP and a text encoding scheme and a header style from SMTP.SIP-URI = sip:x@y:port or sips:x@y:port where x=Username and y=host (domain or IP)</p>
</li>
<li>
<p>[x] SIP takes the help of SDP (Session Description Protocol) which describes a session and RTP (Real Time Transport Protocol) used for delivering voice and video over IP network.</p>
</li>
<li>
<p>[x] SIP can be used for two-party (unicast) or multiparty (multicast) sessions.</p>
</li>
<li>
<p>[x] Other SIP applications include file transfer, instant messaging, video conferencing, online games, and steaming multimedia distribution</p>
</li>
</ul>
<hr />
<p><strong>Facts for Establishing and Terminating Multimedia Communications Using SIP</strong></p>
<p><code>1 - User location:</code> Determination of the end system to be used for communication</p>
<p><code>2 - User availability:</code> Determination of the willingness of the called party to engage in communications</p>
<p><code>3 - User capabilities:</code> Determination of the media and media parameters to be used </p>
<p><code>4 - Session setup:</code> “Ringing", establishment of session parameters at both calling and called party</p>
<p><code>5 - Session management:</code> Including transfer and termination of sessions, modifying session parameters, and invoking services</p>
<hr />
<p>It is the simplicity of SIP that makes it so versatile. SIP is an ASCII- or text-based protocol, similar to HTTP or SMTP. Like HTTP and SMTP, SIP is a request-response protocol, meaning that it makes a request of a server, and awaits a response. Once it has established a session, other protocols handle such tasks as negotiating the type of media to be exchanged, and transporting it between the endpoints. The reusing of existing protocols and their functions means that fewer resources are used, and minimizes the complexity of SIP.</p>
<h2 id="sip-components">SIP Components</h2>
<p><mark>User Agent</mark></p>
<div class="language-text highlight"><pre><span></span><code>- User Agent Client (UAC)
- User Agent Server (UAS)
</code></pre></div>
<p><a class="glightbox" href="../images/2023-09-01-11-59-53.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-01-11-59-53.png" /></a></p>
<hr />
<p><mark>SIP Server</mark></p>
<p><strong>Registrar / Location Server</strong></p>
<p><a class="glightbox" href="../images/2023-09-01-11-50-33.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-01-11-50-33.png" /></a></p>
<p>1 - The User Agent sends a <code>REGISTER</code> request to the SIP server in the registrar role <br>
2 - Once the request is accepted, the Registrar adds the <code>Sip Address</code> and <code>IP Address</code> that the User agent provides to the location service.</p>
<p><strong>Proxy Server</strong></p>
<p><a class="glightbox" href="../images/2023-09-01-12-32-25.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-01-12-32-25.png" /></a></p>
<p>1 - <code>invite</code> request is made to PROXY SRV to invite session with User Agent B<br>
2 - PROXY SRV checks with locater service to determine ip address of User Agent B<br>
3 - <code>invite</code> request is passed to User Agent B<br>
4 - User Agent B accepts request and responses to User Agent A<br>
5 - PROXY SRV passes response to User Agent A<br>
6 - Once invitation is accepted User Agent A and User Agent B can now establish a session.</p>
<p><strong>Redirect Server</strong></p>
<p><a class="glightbox" href="../images/2023-09-01-16-20-08.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-01-16-20-08.png" /></a></p>
<p>1 - <code>invite</code> request is sent to <code>Redirect Server</code><br>
2 - <code>Redirect Server</code> checks location service to find IP Address of User agent B<br>
3 - <code>Redirect server</code> sends information back to the requesting User Agent A<br>
4 - User agent A sends <code>invite</code> to User Agent B<br>
5 - User Agent B responds to User Agent A<br>
6 - Once invitation is accepted User Agent A and User Agent B can now establish a session </p>
<h2 id="basic-sip-call-flow">Basic SIP Call Flow</h2>
<p><a class="glightbox" href="../images/2023-09-01-16-52-49.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-01-16-52-49.png" /></a>
<a class="glightbox" href="../images/2023-09-02-14-40-00.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-14-40-00.png" /></a></p>
<p><mark>PS :</mark> We will discuss every packet and <code>METHOD</code> after <code>Wireshark</code>.</p>
<h2 id="wireshark-usage">Wireshark Usage</h2>
<p>Wireshark is a network packet analyzer. A network packet analyzer presents captured packet data in as much detail as possible.
You could think of a network packet analyzer as a measuring device for examining what’s happening inside a network cable, just like an electrician uses a voltmeter for examining what’s happening inside an electric cable (but at a higher level, of course).</p>
<p>In the past, such tools were either very expensive, proprietary, or both. However, with the advent of Wireshark, that has changed. Wireshark is available for free, is open source, and is one of the best packet analyzers available today.</p>
<p>Here are some reasons people use Wireshark:</p>
<ul>
<li>Network administrators use it to troubleshoot network problems</li>
<li>Network security engineers use it to examine security problems</li>
<li>QA engineers use it to verify network applications</li>
<li>Developers use it to debug protocol implementations</li>
<li>People use it to learn network protocol internals</li>
</ul>
<p>Main program in <code>wireshark</code> is <code>tshark</code>. This name comes from <mark>terminal</mark> keyword. Lets see interfaces in tshark.</p>
<p>C:\Program Files\Wireshark&gt;tshark.exe -D</p>
<p><a class="glightbox" href="../images/2023-09-01-21-41-43.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" height="70%" src="../images/2023-09-01-21-41-43.png" width="70%" /></a></p>
<p>we will choose <code>Wi-Fi</code> interface. Its index number is <code>5</code></p>
<p>C:\Program Files\Wireshark&gt;tshark.exe -i 5</p>
<p><a class="glightbox" href="../images/2023-09-01-21-43-40.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" height="70%" src="../images/2023-09-01-21-43-40.png" width="70%" /></a></p>
<p>There are two kind of filters:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>     Traffic
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>     Traffic
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>     Traffic
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>   x Traffic x
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    x       x
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>     x     x
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>      x   x
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>       x x
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>┌───────────────┐      ┌────────────────┐      ┌─────────────┐      ┌────────────────┐
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>│ Capture filter│ ───► │ Capture Engine │ ───► │ Core Engine │ ───► │ Display Filter │
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>└───────┬───────┘      └────────────────┘      └─────────────┘      └────────┬───────┘
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        │                                                                    │
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        │                                                                    │
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>        └────────────────────────────┐  ┌────────────────────────────────────┘
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>                                     │  │
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>                                     │  │
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>                                     ▼  ▼
</span></code></pre></div>
<p><strong>Capture filter :</strong> <a href="https://wiki.wireshark.org/CaptureFilters">Capture filter</a>, capture specific data which you want then show them. ! Attention. </p>
<p><mark>Example</mark></p>
<p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">host</span> <span class="n">172</span><span class="p">.</span><span class="n">18</span><span class="p">.</span><span class="n">5</span><span class="p">.</span><span class="n">4</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">net</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">24</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">src</span> <span class="n">net</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">24</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">dst</span> <span class="n">net</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">24</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="n">port</span> <span class="n">5060</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">tcp</span> <span class="n">portrange</span> <span class="n">1501</span><span class="p">-</span><span class="n">1549</span>
</span></code></pre></div>
<a class="glightbox" href="../images/2023-09-02-14-53-46.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-14-53-46.png" /></a></p>
<p><strong>Display filter :</strong> <a href="https://wiki.wireshark.org/DisplayFilters">Display Filter</a>, Capture <mark>all traffic</mark> but shows which you want.</p>
<p><div class="language-powershell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">ip</span><span class="p">.</span><span class="n">addr</span><span class="p">==</span><span class="n">172</span><span class="p">.</span><span class="n">18</span><span class="p">.</span><span class="n">5</span><span class="p">.</span><span class="n">4</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">ip</span><span class="p">.</span><span class="n">src</span><span class="p">==</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">16</span> <span class="n">and</span> <span class="n">ip</span><span class="p">.</span><span class="n">dst</span><span class="p">==</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0</span><span class="p">/</span><span class="n">16</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">tcp</span><span class="p">.</span><span class="n">port</span> <span class="n">eq</span> <span class="n">25</span> <span class="n">or</span> <span class="n">icmp</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">ip</span><span class="p">.</span><span class="n">addr</span> <span class="p">!=</span> <span class="n">10</span><span class="p">.</span><span class="n">43</span><span class="p">.</span><span class="n">54</span><span class="p">.</span><span class="n">65</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="n">udp</span><span class="p">.</span><span class="n">dstport</span> <span class="p">==</span> <span class="n">5060</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="n">udp</span><span class="p">.</span><span class="n">port</span> <span class="p">==</span> <span class="n">5060</span>
</span></code></pre></div>
<a class="glightbox" href="../images/2023-09-02-14-57-01.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-14-57-01.png" /></a></p>
<p>We can see <code>SIP Signalling</code> from two method. Every method has different detail level.</p>
<ol>
<li>From Analyze page</li>
</ol>
<p><a class="glightbox" href="../images/2023-09-02-15-10-03.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-15-10-03.png" /></a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>INVITE sip:192.168.80.12 SIP/2.0
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Via: SIP/2.0/UDP 192.168.71.146:50952;rport;branch=z9hG4bKPj15728c40ffd34c83b084dc67d9e93d9c
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Max-Forwards: 70
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>From: &lt;sip:192.168.71.146&gt;;tag=cb9e96b542084e3db354b9a6e98e5527
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>To: &lt;sip:192.168.80.12&gt;
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>Contact: &lt;sip:192.168.80.11:50952;ob&gt;
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>Call-ID: 6c46d346e3084913a77014b523c9e389
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>CSeq: 6521 INVITE
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>Supported: replaces, 100rel, timer, norefersub
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>Session-Expires: 1800
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>Min-SE: 90
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>User-Agent: MicroSIP/3.21.3
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>Content-Type: application/sdp
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>Content-Length:   346
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>v=0
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>o=- 3902655284 3902655284 IN IP4 192.168.71.146
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>s=pjmedia
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>b=AS:84
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>t=0 0
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>a=X-nat:0
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>m=audio 4008 RTP/AVP 8 0 101
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>c=IN IP4 192.168.71.146
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>b=TIAS:64000
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>a=rtcp:4009 IN IP4 192.168.71.146
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>a=sendrecv
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>a=rtpmap:8 PCMA/8000
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>a=rtpmap:0 PCMU/8000
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>a=rtpmap:101 telephone-event/8000
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>a=fmtp:101 0-16
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>a=ssrc:1913920969 cname:1ebf1ac11af82313
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>SIP/2.0 100 Trying
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>Via: SIP/2.0/UDP 192.168.71.146:50952;rport=50952;received=192.168.80.11;branch=z9hG4bKPj15728c40ffd34c83b084dc67d9e93d9c
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>Call-ID: 6c46d346e3084913a77014b523c9e389
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>From: &lt;sip:192.168.71.146&gt;;tag=cb9e96b542084e3db354b9a6e98e5527
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>To: &lt;sip:192.168.80.12&gt;
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a>CSeq: 6521 INVITE
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a>Content-Length:  0
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>SIP/2.0 180 Ringing
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>Via: SIP/2.0/UDP 192.168.71.146:50952;rport=50952;received=192.168.80.11;branch=z9hG4bKPj15728c40ffd34c83b084dc67d9e93d9c
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>Call-ID: 6c46d346e3084913a77014b523c9e389
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a>From: &lt;sip:192.168.71.146&gt;;tag=cb9e96b542084e3db354b9a6e98e5527
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>To: &lt;sip:192.168.80.12&gt;;tag=9d6ab2e6da5e4ad09aea771ed6a12343
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>CSeq: 6521 INVITE
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>Contact: &lt;sip:192.168.80.12:63043&gt;
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a>Content-Length:  0
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>SIP/2.0 200 OK
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a>Via: SIP/2.0/UDP 192.168.71.146:50952;rport=50952;received=192.168.80.11;branch=z9hG4bKPj15728c40ffd34c83b084dc67d9e93d9c
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a>Call-ID: 6c46d346e3084913a77014b523c9e389
</span><span id="__span-3-54"><a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a>From: &lt;sip:192.168.71.146&gt;;tag=cb9e96b542084e3db354b9a6e98e5527
</span><span id="__span-3-55"><a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a>To: &lt;sip:192.168.80.12&gt;;tag=9d6ab2e6da5e4ad09aea771ed6a12343
</span><span id="__span-3-56"><a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a>CSeq: 6521 INVITE
</span><span id="__span-3-57"><a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a>Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
</span><span id="__span-3-58"><a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a>Contact: &lt;sip:192.168.80.12:63043&gt;
</span><span id="__span-3-59"><a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a>Supported: replaces, 100rel, timer, norefersub
</span><span id="__span-3-60"><a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a>Session-Expires: 1800;refresher=uac
</span><span id="__span-3-61"><a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>Require: timer
</span><span id="__span-3-62"><a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a>Content-Type: application/sdp
</span><span id="__span-3-63"><a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a>Content-Length:   319
</span><span id="__span-3-64"><a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a>
</span><span id="__span-3-65"><a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a>v=0
</span><span id="__span-3-66"><a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a>o=- 3902655283 3902655284 IN IP4 192.168.80.12
</span><span id="__span-3-67"><a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a>s=pjmedia
</span><span id="__span-3-68"><a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a>b=AS:84
</span><span id="__span-3-69"><a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a>t=0 0
</span><span id="__span-3-70"><a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a>a=X-nat:0
</span><span id="__span-3-71"><a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a>m=audio 4008 RTP/AVP 8 101
</span><span id="__span-3-72"><a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a>c=IN IP4 192.168.80.12
</span><span id="__span-3-73"><a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a>b=TIAS:64000
</span><span id="__span-3-74"><a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a>a=rtcp:4009 IN IP4 192.168.80.12
</span><span id="__span-3-75"><a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a>a=sendrecv
</span><span id="__span-3-76"><a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a>a=rtpmap:8 PCMA/8000
</span><span id="__span-3-77"><a id="__codelineno-3-77" name="__codelineno-3-77" href="#__codelineno-3-77"></a>a=rtpmap:101 telephone-event/8000
</span><span id="__span-3-78"><a id="__codelineno-3-78" name="__codelineno-3-78" href="#__codelineno-3-78"></a>a=fmtp:101 0-16
</span><span id="__span-3-79"><a id="__codelineno-3-79" name="__codelineno-3-79" href="#__codelineno-3-79"></a>a=ssrc:1170553184 cname:54d60ea93f0b3087
</span><span id="__span-3-80"><a id="__codelineno-3-80" name="__codelineno-3-80" href="#__codelineno-3-80"></a>ACK sip:192.168.80.12:63043 SIP/2.0
</span><span id="__span-3-81"><a id="__codelineno-3-81" name="__codelineno-3-81" href="#__codelineno-3-81"></a>Via: SIP/2.0/UDP 192.168.71.146:50952;rport;branch=z9hG4bKPj7547c750e9514daf911980bf590fcfae
</span><span id="__span-3-82"><a id="__codelineno-3-82" name="__codelineno-3-82" href="#__codelineno-3-82"></a>Max-Forwards: 70
</span><span id="__span-3-83"><a id="__codelineno-3-83" name="__codelineno-3-83" href="#__codelineno-3-83"></a>From: &lt;sip:192.168.71.146&gt;;tag=cb9e96b542084e3db354b9a6e98e5527
</span><span id="__span-3-84"><a id="__codelineno-3-84" name="__codelineno-3-84" href="#__codelineno-3-84"></a>To: &lt;sip:192.168.80.12&gt;;tag=9d6ab2e6da5e4ad09aea771ed6a12343
</span><span id="__span-3-85"><a id="__codelineno-3-85" name="__codelineno-3-85" href="#__codelineno-3-85"></a>Call-ID: 6c46d346e3084913a77014b523c9e389
</span><span id="__span-3-86"><a id="__codelineno-3-86" name="__codelineno-3-86" href="#__codelineno-3-86"></a>CSeq: 6521 ACK
</span><span id="__span-3-87"><a id="__codelineno-3-87" name="__codelineno-3-87" href="#__codelineno-3-87"></a>Content-Length:  0
</span><span id="__span-3-88"><a id="__codelineno-3-88" name="__codelineno-3-88" href="#__codelineno-3-88"></a>
</span><span id="__span-3-89"><a id="__codelineno-3-89" name="__codelineno-3-89" href="#__codelineno-3-89"></a>BYE sip:192.168.80.12:63043 SIP/2.0
</span><span id="__span-3-90"><a id="__codelineno-3-90" name="__codelineno-3-90" href="#__codelineno-3-90"></a>Via: SIP/2.0/UDP 192.168.71.146:50952;rport;branch=z9hG4bKPja096382a15374b02ae4f3e3928adc9f5
</span><span id="__span-3-91"><a id="__codelineno-3-91" name="__codelineno-3-91" href="#__codelineno-3-91"></a>Max-Forwards: 70
</span><span id="__span-3-92"><a id="__codelineno-3-92" name="__codelineno-3-92" href="#__codelineno-3-92"></a>From: &lt;sip:192.168.71.146&gt;;tag=cb9e96b542084e3db354b9a6e98e5527
</span><span id="__span-3-93"><a id="__codelineno-3-93" name="__codelineno-3-93" href="#__codelineno-3-93"></a>To: &lt;sip:192.168.80.12&gt;;tag=9d6ab2e6da5e4ad09aea771ed6a12343
</span><span id="__span-3-94"><a id="__codelineno-3-94" name="__codelineno-3-94" href="#__codelineno-3-94"></a>Call-ID: 6c46d346e3084913a77014b523c9e389
</span><span id="__span-3-95"><a id="__codelineno-3-95" name="__codelineno-3-95" href="#__codelineno-3-95"></a>CSeq: 6522 BYE
</span><span id="__span-3-96"><a id="__codelineno-3-96" name="__codelineno-3-96" href="#__codelineno-3-96"></a>User-Agent: MicroSIP/3.21.3
</span><span id="__span-3-97"><a id="__codelineno-3-97" name="__codelineno-3-97" href="#__codelineno-3-97"></a>Content-Length:  0
</span><span id="__span-3-98"><a id="__codelineno-3-98" name="__codelineno-3-98" href="#__codelineno-3-98"></a>
</span><span id="__span-3-99"><a id="__codelineno-3-99" name="__codelineno-3-99" href="#__codelineno-3-99"></a>SIP/2.0 200 OK
</span><span id="__span-3-100"><a id="__codelineno-3-100" name="__codelineno-3-100" href="#__codelineno-3-100"></a>Via: SIP/2.0/UDP 192.168.71.146:50952;rport=50952;received=192.168.80.11;branch=z9hG4bKPja096382a15374b02ae4f3e3928adc9f5
</span><span id="__span-3-101"><a id="__codelineno-3-101" name="__codelineno-3-101" href="#__codelineno-3-101"></a>Call-ID: 6c46d346e3084913a77014b523c9e389
</span><span id="__span-3-102"><a id="__codelineno-3-102" name="__codelineno-3-102" href="#__codelineno-3-102"></a>From: &lt;sip:192.168.71.146&gt;;tag=cb9e96b542084e3db354b9a6e98e5527
</span><span id="__span-3-103"><a id="__codelineno-3-103" name="__codelineno-3-103" href="#__codelineno-3-103"></a>To: &lt;sip:192.168.80.12&gt;;tag=9d6ab2e6da5e4ad09aea771ed6a12343
</span><span id="__span-3-104"><a id="__codelineno-3-104" name="__codelineno-3-104" href="#__codelineno-3-104"></a>CSeq: 6522 BYE
</span><span id="__span-3-105"><a id="__codelineno-3-105" name="__codelineno-3-105" href="#__codelineno-3-105"></a>Content-Length:  0
</span></code></pre></div>
<ol>
<li>From Telephony / Voip Calls</li>
</ol>
<p><a class="glightbox" href="../images/2023-09-02-15-24-37.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-15-24-37.png" /></a></p>
<p>with export button, you can export this flow as <code>PDF</code><br>
with time of Day, you can convert unix time to human readable time</p>
<p><strong>Export Output PCAP file</strong></p>
<p>There are some tricks PCAP OUTPUT. Lets discus on screenshoot</p>
<p><a class="glightbox" href="../images/2023-09-02-15-43-48.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-15-43-48.png" /></a></p>
<ul>
<li>Choose <code>output</code> for export data</li>
<li>Create folder for store log and input the pat of folder</li>
<li>Decide how long PCAP file which you want to store. Actually there is no limit with pcap file but you sholud limit the <code>one file size</code>. I recommend maximum 1GB for one file or <code>ten minutes</code> for one file.</li>
<li>Use <code>Use a ring buffer with</code></li>
</ul>
<p>As you see below example: I limit total 25 sec log with 5sec files. File 1 and 2 is erased because on <code>Use a ring buffer with</code> value. </p>
<p><a class="glightbox" href="../images/2023-09-02-15-52-40.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-15-52-40.png" /></a></p>
<h2 id="rtp-analysis">RTP Analysis</h2>
<p>A <code>SIP CALL</code> consist of 2 parts. One of them is <code>signalling</code> and the other is <code>media</code>. In media transferring, SIP use Real Time Transport Protocol (RTP) which is define by <a href="https://datatracker.ietf.org/doc/html/rfc3550">RFC-3550</a>. Real Time Protocol (RTP) carries the voice payload across the network from transmitter to receiver. This payload is a continuous stream of packets that traverses the network.</p>
<p>RTP Effected basicly three network phenomenons.</p>
<ol>
<li>
<p><strong>Latency :</strong> VoIP over high latency links may not have any quality problems, but it creates awkward communications involving interruptions, talking on top of someone else, and strange silences because you don't know if the other person has stopped talking yet. One-way latency for VoIP/UC should be below <code>125ms (250ms round-trip)</code>. Users will tend to notice higher latencies.</p>
</li>
<li>
<p><strong>Jitter :</strong> In the real world, some packets may be delayed, thus causing some packets to arrive late, with the packets behind them all being bunched up and arriving too soon behind them. In general, jitter should be below <code>30ms</code> when received by the endpoint.</p>
</li>
<li>
<p><strong>Packet Lose :</strong> Packet loss affects real-time protocols like VoIP and video by creating drop-outs, clipped words, and video artifacts. Entire phrases might also be missing from the conversation. If the packet loss gets really bad, one side of the audio stream can completely disconnect causing one-way audio, or if packet loss is bi-directional, the entire call can drop. In general, packet loss should be below <code>1 %</code>  when received by the endpoint.</p>
</li>
</ol>
<p><mark><strong>How Can we detect ?</strong></mark></p>
<p>Answer is wireshark. We can analysis RTP performance with wireshark telephony / RTP / RTP Streams</p>
<p><a class="glightbox" href="../images/2023-09-02-16-17-48.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-16-17-48.png" /></a>
<a class="glightbox" href="../images/2023-09-02-16-21-42.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-16-21-42.png" /></a></p>
<p><strong>RTP and RTCP</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>                    +------------+-------------+-------------+-------------------------+
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>                    | IP Headers | UDP Headers | RTP Headers |       RTP Payload       |
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>                    |  20 Byte   |   8 Byte    |  12 Byte    |                         |
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>                    +------------+-------------+-------------+-------------------------+
</span></code></pre></div>
<p>RTP is used in conjunction with the RTP Control Protocol (RTCP). While RTP carries the media streams (e.g., audio and video), RTCP is used to monitor transmission statistics and quality of service (QoS) and aids synchronization of multiple streams. RTP is originated and received on even port numbers and the associated RTCP communication uses the next higher odd port number.</p>
<p><a class="glightbox" href="../images/2023-09-02-16-26-46.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-16-26-46.png" /></a></p>
<p><strong>RTP Header</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>                      0                   1                   2                   3
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>                      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>                      |V=2|P|X|  CC   |M|     PT      |       sequence number         |
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>                      |                           timestamp                           |
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>                      |           synchronization source (SSRC) identifier            |
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>                      +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>                      |            contributing source (CSRC) identifiers             |
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>                      |                             ....                              |
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>                      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></code></pre></div>
<p><strong>Version -</strong> This 2-bit field defines version number. The current version is 2.<br>
<strong>Padding –</strong> The length of this field is 1-bit. If value is 1, then it denotes presence of padding at end of packet and if value is 0, then there is no padding.<br>
<strong>Extension –</strong> The length of this field is also 1-bit. If value of this field is set to 1, then its indicates an extra extension header between data and basic header and if value is 0 then, there is no extra extension.
<strong>Contributor Count -</strong> This 4-bit field indicates number of contributors. Here maximum possible number of contributor is 15 as a 4-bit field can allows number from 0 to 15.<br>
<strong>Marker –</strong> The length of this field is 1-bit and it is used as end marker by application to indicate end of its data.<br>
<strong>Payload types -</strong> This field is of length 7-bit to indicate type of payload. We list applications of some common types of payload.<br></p>
<p><mark>Example :</mark></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>+--------+--------------+
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>| PT     |    FORMAT    |
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>+--------+--------------+
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>| 0      |    G711u-law |
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>| 8      |    G711a-law |
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>| 9      |    G722      |
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>| 18     |    G729      |
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>| 26     |    Jpeg      |
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>| 34     |    H323      |
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>| 101    |    DTMF      |
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>| ...    |    ...       |
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>+--------+--------------+
</span></code></pre></div>
<p><strong>Sequence Number –</strong> The length of this field is 16 bits. It is used to give serial numbers to RTP packets. It helps in sequencing. The sequence number for first packet is given a random number and then every next packet’s sequence number is incremented by 1. This field mainly helps in checking lost packets and order mismatch.<br>
<strong>Time Stamp –</strong> The length of this field is 32-bit. It is used to find relationship between times of different RTP packets. The timestamp for first packet is given randomly and then time stamp for next packets given by sum of previous timestamp and time taken to produce first byte of current packet. The value of 1 clock tick is varying from application to application.<br>
<strong>Synchronization Source Identifier –</strong> This is a 32-bit field used to identify and define the source. The value for this source identifier is a random number that is chosen by source itself. This mainly helps in solving conflict arises when two sources started with the same sequencing number.<br>
<strong>Contributor Identifier –</strong> This is also a 32-bit field used for source identification where there is more than one source present in session. The mixer source use Synchronization source identifier and other remaining sources (maximum 15) use Contributor identifier.</p>
<p><mark>Example of RTP Header</mark></p>
<h2 id="_1"><a class="glightbox" href="../images/2023-09-02-16-48-49.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-16-48-49.png" /></a></h2>
<p><strong>Impact of Voice Samples and Packet Size on Bandwidth</strong></p>
<p><strong>DSP coverts analog voice signal to digital</strong> voice signal using a particular codec. Based on the codec used, the DSP generates so many bits per second. The bits that are generated for 10 milliseconds (ms) of analog voice signal form one digital voice sample. The size of the digital voice sample depends on the codec used. </p>
<p><mark>For example, Assume that we are using g711 codec:</mark></p>
<p>in every 10ms period DSP generates 80 byte, there are 100 times 10ms in 1 second. Totally in 1 second DSP generates 8000 byte
If we calculate as <code>bit</code> 8000 X 8 = 64000 for one second. </p>
<p>for our wireshark output, timestamp shows us in between RTP Packets there are 160 byte, that means this payload contains 20ms data, that means there are 50 RTP packets for only one second. </p>
<p><a class="glightbox" href="../images/2023-09-02-18-36-02.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-18-36-02.png" /></a></p>
<p>Lets analysis all IP Packet, frame lenght is 214 byte</p>
<p><a class="glightbox" href="../images/2023-09-02-18-44-19.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-18-44-19.png" /></a></p>
<p>IP header shows us total lenght 200 byte, IP header is 20 byte. This means frame header is 14 byte (ethernet)</p>
<p><a class="glightbox" href="../images/2023-09-02-18-47-15.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-18-47-15.png" /></a></p>
<p>then if we calculate UDP header, RTP header and payload </p>
<p><a class="glightbox" href="../images/2023-09-02-18-51-04.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-18-51-04.png" /></a></p>
<p>Calculation is ok.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>+-----------------------+
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>| RTP Payload      160  |
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>| RTP Header       12   |
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>| UDP Header       8    |
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>| IP Header        20   |
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>| Frame Header     14   |
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>+-----------------------+
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>| TOTAL            214  |
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>+-----------------------+
</span></code></pre></div>
<h2 id="sip-methods-and-headers">SIP Methods and Headers</h2>
<ul>
<li>Everything is <code>METHOD</code> in sip. SIP is an application layer protocol that is very similar to text based application layer protocols like HTTP. In fact, it is also uses request and response message transactions and header fields.</li>
<li>For transport, SIP can run over TCP, UDP, or SCTP transport layer protocols. </li>
<li>IP borrows the Method field from HTTP to likewise determine the type of request. SIP has 14 Method request types. The most commonly used Methods are INVITE, ACK, BYE, and REGISTER which are used during voice calls. The first line of a SIP request message includes the Method type and the request URI which is the current destination of the request. </li>
</ul>
<p><strong>Example of SIP Request</strong></p>
<p><a class="glightbox" href="../images/2023-09-02-21-32-21.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-02-21-32-21.png" /></a></p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>INVITE sip:192.168.80.12 SIP/2.0
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>Via: SIP/2.0/UDP 192.168.71.146:50952;rport;branch=z9hG4bKPj15728c40ffd34c83b084dc67d9e93d9c
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>Max-Forwards: 70
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>From: &lt;sip:192.168.71.146&gt;;tag=cb9e96b542084e3db354b9a6e98e5527
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>To: &lt;sip:192.168.80.12&gt;
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>Contact: &lt;sip:192.168.80.11:50952;ob&gt;
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>Call-ID: 6c46d346e3084913a77014b523c9e389
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>CSeq: 6521 INVITE
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>Supported: replaces, 100rel, timer, norefersub
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>Session-Expires: 1800
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>Min-SE: 90
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>User-Agent: MicroSIP/3.21.3
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>Content-Type: application/sdp
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>Content-Length:   346
</span></code></pre></div>
<strong>Common SIP request Headers</strong></p>
<p><strong>VIA :</strong> Contains an address that is used to route back replies.<br>
<strong>MAX-FORWARDS :</strong> Show max path like (TTL)<br>
<strong>FROM :</strong> Contains the SIP URI of the caller.<br>
<strong>TO :</strong> Contains the SIP URI of the callee.<br>
<strong>CONTACT :</strong> Contains the SIP URI to be used for future requests for this caller.<br>
<strong>CALL-ID :</strong> Contains the globally unique identification for this call using the caller's domain.<br>
<strong>CSEQ :</strong> Contains the sequence number of this message for this SIP conversation.<br>
<strong>ALLOW :</strong> Contains the support methods<br>
<strong>SUPPORTED :</strong> Contains the supported extentions<br>
<strong>SESSION-EXPRIRES :</strong> Show total sip session time. End of this time, sip session is refresh.<br>
<strong>MIN-SE :</strong> Show minimum session time<br>
<strong>USER-AGENT :</strong> Contains Information about agent <br>
<strong>CONTENT-TYPE :</strong> Contains the content type for the message body.<br>
<strong>CONTENT-LENGHT :</strong> Contains the byte count length for the message body.</p>
<p><strong>SIP  METHODS</strong></p>
<p><mark>- Invite :</mark> The invite message initiates a SIP dialog with the intent to establish a call. It is sent by a user agent client to a user agent server. When sent during an established dialog <code>(reinvite)</code> it modifies the sessions, for example placing a call on hold. <br>
<mark>- ACK :</mark> Confirm that an entity has received a final response to an INVITE request.<br>
<mark>- BYE :</mark> This method signals termination of a dialog and ends a call. This message may be sent by either endpoint of a dialog.<br>
<mark>- CANCEL :</mark> Cancel any pending request.  Usually means terminating a SIP call while it is still ringing, before answer.<br>
<mark>- OPTIONS :</mark> Query the capabilities of an endpoint.  It is often used for keepalive purposes.<br>
<mark>- REGISTER :</mark> Register the SIP URI listed in the To header field with a location server and associates it with the network address given in a Contact header field.  It implements a location service.<br>
<mark>- REFER :</mark> Used for call transfer.
<mark>- PRACK :</mark> <a href="https://datatracker.ietf.org/doc/html/rfc3262">PRACK</a> is sent in response to provisional response (1xx). SIP defines two types of responses, provisional and final.Final responses convey the result of the request processing, and are sent reliably. Provisional responses provide information on the progress of the request processing, but are not sent reliably in <a href="https://datatracker.ietf.org/doc/html/rfc3261">RFC 3261</a><br>
<mark>- SUBSCRIBE :</mark> Initiates a subscription for notification of events from a notifier, like presence information. <br />
<mark>- NOTIFY :</mark> The NOTIFY message is used to notify other users or devices when there are changes in a monitored entity or event. It is used to send notifications when there are changes in a monitored presence or event, such as a change in online status or a call initiation event.<br>
<mark>- PUBLISH :</mark> The PUBLISH message is used by a user or device to report its own presence or status to a SIP server or other subscribers. It is commonly used to update one's status or to send instant messages.<br>
<mark>- MESSAGE :</mark> Transport text messages.<br>
<mark>-INFO :</mark> Send mid-session information that does not modify the session state. This method is often used for DTMF relay.<br>
<mark>-UPDATE :</mark> Modifies the state of a session without changing the state of the dialog.</p>
<p><strong>SIP Transaction &amp; Session &amp; Dialog</strong></p>
<p><mark>Transaction :</mark> Consists of a Request and final (2-6)XX response <br>
<mark>Session :</mark> Session  is just a media stream (e.g. audio or video) flowing between peers<br>
<mark>Dialog :</mark> Dialog is just a series of transactions between two SIP peers. The purpose of a dialog is to setup, possibly modify, and then teardown a session</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>┌──────────────────────────────────┐       ────────────────┐
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>│             Invite               │                       │
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>│ ──────────────────────────────►  │                       │
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>│          100 Trying              │                       │
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>│ ◄──────────────────────────────  │                       │
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>│          180 Ringing             │ ────► Transaction     │
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>│ ◄──────────────────────────────  │                       │
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>│            200 OK                │                       │
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>│ ◄──────────────────────────────  │                       │
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>│                                  │                       │
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>├──────────────────────────────────┤                       │
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>│              ACK                 │                       │
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>│ ──────────────────────────────►  │ ────► Transaction     ├────► Dialog
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>│                                  │                       │
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>├──────────────────────────────────┤                       │
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>│            RTP Data              │                       │
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>│ ◄──────────────────────────────► │ ────► Session         │
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>│                                  │                       │
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>├──────────────────────────────────┤                       │
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>│                BYE               │                       │
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>│ ───────────────────────────────► │                       │
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>│              200 OK              │ ────► Transaction     │
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>│ ◄─────────────────────────────── │                       │
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>│                                  │                       │
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>└──────────────────────────────────┘       ────────────────┘
</span></code></pre></div>
<p>There are two different defination about <code>requests</code>. In one dialog, there is one <code>initial request</code> others are sequential request.</p>
<p>Initial Requests<br>
- Can be easily identified by the From-tag<br>
- Example: First INVITE<br></p>
<p>Sequential (in-dialog) Requests<br>
- Same Call-ID, From tag and To tag<br>
- Example: BYE,ACK,RE-INVITE</p>
<p><strong>Branch, Call-ID and From/to Tag</strong></p>
<p>There are three deffination with hash in SIP. These definations guide us to folow sip message in mess sip log. This section is very important. </p>
<p><mark>Branch :</mark> Means transaction. As you know transaction is combination of request and its response. every transaction defined by a unique branch number.</p>
<p>Lets flashback to wireshark capture of normal clear sip to sip basic call. You will see three branch-id it means there three transaction on this sip call.</p>
<p><a class="glightbox" href="../images/2023-09-04-11-00-42.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-11-00-42.png" /></a></p>
<p><mark>Call-ID</mark> Means SIP call. Transactions which belogs to same call define bye same call-id.</p>
<p><a class="glightbox" href="../images/2023-09-04-11-04-12.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-11-04-12.png" /></a></p>
<p><mark>From / To Tag</mark> From and To define <code>caller</code> and <code>callee</code>.</p>
<p><a class="glightbox" href="../images/2023-09-04-11-09-09.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-11-09-09.png" /></a></p>
<p>PS: why there is no <code>to tag</code> in first two sip message ?</p>
<p><strong>SDP and Early Offer / Delay Offer</strong></p>
<p>The <a href="https://datatracker.ietf.org/doc/html/rfc4566">SDP</a> (Session Description Protocol) contains a description of the media format and protocols supported by a device. The SDP is sent by both sides of a connection during the call set up process. The difference between Early Offer and Late Offer is in which SIP Message the SDP is sent.</p>
<p>In an Early Offer call, the SDP message is sent by the calling endpoint in the initial invite message. The receiving endpoint sends their SDP in the 200 OK message sent when the call is answered.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>INVITE sip:192.168.80.12 SIP/2.0
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>Via: SIP/2.0/UDP 192.168.71.146:50952;rport;branch=z9hG4bKPj15728c40ffd34c83b084dc67d9e93d9c
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>Max-Forwards: 70
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>From: &lt;sip:192.168.71.146&gt;;tag=cb9e96b542084e3db354b9a6e98e5527
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>To: &lt;sip:192.168.80.12&gt;
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>Contact: &lt;sip:192.168.80.11:50952;ob&gt;
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>Call-ID: 6c46d346e3084913a77014b523c9e389
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>CSeq: 6521 INVITE
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>Supported: replaces, 100rel, timer, norefersub
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>Session-Expires: 1800
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>Min-SE: 90
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>User-Agent: MicroSIP/3.21.3
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>Content-Type: application/sdp
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>Content-Length:   346
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>                                     ─────────────┐
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>v=0                                               │
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>o=- 3902655284 3902655284 IN IP4 192.168.71.146   │
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>s=pjmedia                                         │
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>b=AS:84                                           │
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>t=0 0                                             │
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>a=X-nat:0                                         │
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>m=audio 4008 RTP/AVP 8 0 101                      │
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>c=IN IP4 192.168.71.146                           │
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>b=TIAS:64000                                      ├────► SDP
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>a=rtcp:4009 IN IP4 192.168.71.146                 │
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>a=sendrecv                                        │
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>a=rtpmap:8 PCMA/8000                              │
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>a=rtpmap:0 PCMU/8000                              │
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>a=rtpmap:101 telephone-event/8000                 │
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>a=fmtp:101 0-16                                   │
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>a=ssrc:1913920969 cname:1ebf1ac11af82313          │
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>                                                  │
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>                                    ──────────────┘
</span></code></pre></div>
<p>Some lines in each description are REQUIRED and some are OPTIONAL,but all MUST appear in exactly the order given here (the fixed order greatly enhances error detection and allows for a simple parser).OPTIONAL items are marked with a "*".</p>
<p>Session description</p>
<div class="language-text highlight"><pre><span></span><code>     v=  (protocol version)
     o=  (originator and session identifier)
     s=  (session name)
     i=* (session information)
     u=* (URI of description)
     e=* (email address)
     p=* (phone number)
     c=* (connection information -- not required if included in
          all media)
     b=* (zero or more bandwidth information lines)
     One or more time descriptions (&quot;t=&quot; and &quot;r=&quot; lines; see below)
     z=* (time zone adjustments)
     k=* (encryption key)
     a=* (zero or more session attribute lines)
     Zero or more media descriptions
</code></pre></div>
<p>Time description</p>
<div class="language-text highlight"><pre><span></span><code>     t=  (time the session is active)
     r=* (zero or more repeat times)
</code></pre></div>
<p>Media description, if present</p>
<div class="language-text highlight"><pre><span></span><code>     m=  (media name and transport address)
     i=* (media title)
     c=* (connection information -- optional if included at
          session level)
     b=* (zero or more bandwidth information lines)
     k=* (encryption key)
     a=* (zero or more media attribute lines)
</code></pre></div>
<p>In a Late Offer call, the receiving endpoint still sends their SDP in the 200 OK message but the calling endpoint doesn't sent theirs until Acknowledgement message which is sent after they receive the 200 OK from the receiving endpoint.</p>
<p>Some sip device use delay offer by default like <code>cisco unified call manager</code>, some sip device use early offer like <code>micro sip</code></p>
<p><strong>Cancel Method</strong></p>
<p>The CANCEL informs Jennifer that Andrew is releasing the session prematurely and Jennifer needs to do the same on her end. In other words, Jennifer’s phone should stop ringing and return to an idle state.</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>┌──────────────┐                Invite                 ┌──────────────┐
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>│    ANDREW    │    ──────────────────────────────►    │  JENNIFER    │
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>└──────────────┘                                       └──────────────┘
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>                             100 Trying
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>                    ◄──────────────────────────────
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>                             180 Ringing
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>                    ◄──────────────────────────────
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>               Andrew hangs up before the call is answered
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>                                CANCEL
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>                    ──────────────────────────────►
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>                                200 OK
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>                    ◄──────────────────────────────
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>                       487 Request Terminated
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>                    ◄──────────────────────────────
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>                                 ACK
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>                    ───────────────────────────────►
</span></code></pre></div>
lets test in lab</p>
<p><a class="glightbox" href="../images/2023-09-03-21-39-48.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-03-21-39-48.png" /></a></p>
<p>Second senario for <code>CANCEL</code> method is stopping ringing the shared line. </p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>                                                        ┌──────────────┐
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>                                                        │  JENNIFER    │ 3 - Turn on the phone
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>                                                        └──────────────┘
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>                                                               ▲
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>                                                               │
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>                                 ┌───────┐                     │2 - Ringging
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>┌──────────────┐ 1 - Call 1000   │       │                     │
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>│    ANDREW    ├────────────────►│  PBX  ├─────────────────────┤
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>└──────────────┘                 │       │                     │
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>                                 └─────┬─┘                     │2 - Ringging
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>                                       │                       │
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>                                       │                       ▼
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>                                       │                ┌──────────────┐
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>                                       └───────────────►│  JENNIFER    │
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>                                         4 - PBX sends  └──────────────┘
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>                                         to CANCEL the
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>                                         shared line
</span></code></pre></div>
<strong>Message Method</strong></p>
<p>The <a href="https://www.rfc-editor.org/rfc/rfc3428.html">SIP MESSAGE</a> method looks / acts very similar to a SIP INVITE, in that it’s got all the standard SIP headers, but also a Message Body, in which our message body lives (funny about that), typically we’ll send messages using the Content-Type: text/plain to denote we’re sending a plaintext message.</p>
<p>Lets check in our lab environment</p>
<p><a class="glightbox" href="../images/2023-09-04-12-10-58.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-12-10-58.png" /></a></p>
<p>on wireshark</p>
<p><a class="glightbox" href="../images/2023-09-04-12-12-26.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-12-12-26.png" /></a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>MESSAGE sip:192.168.80.12 SIP/2.0
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>Via: SIP/2.0/UDP 192.168.71.146:50952;rport;branch=z9hG4bKPjb3a637173a7749388acfa945363e2935
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>Max-Forwards: 70
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>From: &lt;sip:192.168.71.146&gt;;tag=1f230d794d874ff98d54cbc549915971
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>To: &lt;sip:192.168.80.12&gt;
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>Call-ID: 135f6ded4f5c45dab6af3d5626e0b4ef
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>CSeq: 11151 MESSAGE
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>User-Agent: MicroSIP/3.21.3
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>Content-Type: text/plain
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>Content-Length:     5
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>selamSIP/2.0 200 OK
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>Via: SIP/2.0/UDP 192.168.71.146:50952;rport=50952;received=192.168.80.11;branch=z9hG4bKPjb3a637173a7749388acfa945363e2935
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>Call-ID: 135f6ded4f5c45dab6af3d5626e0b4ef
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>From: &lt;sip:192.168.71.146&gt;;tag=1f230d794d874ff98d54cbc549915971
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>To: &lt;sip:192.168.80.12&gt;;tag=z9hG4bKPjb3a637173a7749388acfa945363e2935
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>CSeq: 11151 MESSAGE
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>Content-Length:  0
</span></code></pre></div>
<p><strong>Option Method</strong></p>
<p>OPTIONS allows a user agent (UA) to query another UA or a proxy server as to its capabilities. This allows a client to discover information about the supported methods, content types, extensions, codecs, etc. without “ringing” the other party.</p>
<p>For testing <code>SIP Option</code> we use cisco Call Manager. send option from Cisco CUCM to  Micro Sip. For this test we need 2 configuration on CUCM:</p>
<ol>
<li>Sip Profile</li>
<li>Sip trunk with sip profile which create previous step</li>
</ol>
<p>For sip profile. Choose sip profile then clone <code>Default sip profile</code> and rename as <code>SP_SIP_OPTION</code> or something you want. Enable <code>ping option</code> with default parameters. </p>
<p><a class="glightbox" href="../images/2023-09-03-23-01-02.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-03-23-01-02.png" /></a>
<a class="glightbox" href="../images/2023-09-03-23-04-32.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-03-23-04-32.png" /></a>
<a class="glightbox" href="../images/2023-09-03-23-05-47.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-03-23-05-47.png" /></a></p>
<p>then create sip trunk to micro-sip with ip address of micro-sip. Use SP_SIP_OPTION as a sip proflie.</p>
<p><a class="glightbox" href="../images/2023-09-03-23-07-05.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-03-23-07-05.png" /></a>
<a class="glightbox" href="../images/2023-09-03-23-08-54.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-03-23-08-54.png" /></a></p>
<p>After this configuration, restart SIP Trunk on CUCM then CUCM will begin to send sip option packet to Micro sip. Lets check on wireshark.</p>
<p><a class="glightbox" href="../images/2023-09-03-23-17-20.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-03-23-17-20.png" /></a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>OPTIONS sip:192.168.80.11:5060 SIP/2.0
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>Via: SIP/2.0/TCP 192.168.80.100:5060;branch=z9hG4bK3220cd6291
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>From: &lt;sip:192.168.80.100&gt;;tag=471242191
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>To: &lt;sip:192.168.80.11&gt;
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>Date: Sun, 03 Sep 2023 20:11:53 GMT
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>Call-ID: 1e55d000-1ef16899-13-6450a8c0@192.168.80.100
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>User-Agent: Cisco-CUCM14.0
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>CSeq: 101 OPTIONS
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>Contact: &lt;sip:192.168.80.100:5060;transport=tcp&gt;
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>Max-Forwards: 0
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>Content-Length: 0
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>SIP/2.0 200 OK
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>Via: SIP/2.0/TCP 192.168.80.100:5060;received=192.168.80.100;branch=z9hG4bK3220cd6291
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>Call-ID: 1e55d000-1ef16899-13-6450a8c0@192.168.80.100
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>From: &lt;sip:192.168.80.100&gt;;tag=471242191
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>To: &lt;sip:192.168.80.11&gt;;tag=z9hG4bK3220cd6291
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>CSeq: 101 OPTIONS
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>Accept: application/sdp, application/pidf+xml, application/xpidf+xml, application/simple-message-summary, message/sipfrag;version=2.0, application/im-iscomposing+xml, text/plain
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>Supported: replaces, 100rel, timer, norefersub, trickle-ice
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>Allow-Events: presence, message-summary, refer
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>User-Agent: MicroSIP/3.21.3
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>Content-Length:  0
</span></code></pre></div>
<p><strong>SIP Register Method</strong></p>
<p>SIP is a peer-to-peer protocol where the roles client – server and exchangeable depending on who starts a session. In reality most deployments foresee a process called registration (method: REGISTER) which allows a central server (registrar) to store the location of a SIP User-Agent.</p>
<p>A SIP Phone is a client to the central Unified Communication Platform (registrar) – and the UC platform is a client to the SIP Server of the operator (registrar).</p>
<p>Once the SIP Server gets to know the location of an SIP Client, it can deliver calls and other messages to it from other Clients connected to the same Server.</p>
<p><mark>Example</mark></p>
<p>Lets check procedure on CUCM as a server and MicroSIP as a client. Firstly prepare necessary defination on CUCM for registration. </p>
<ol>
<li>Creat <code>End User</code> on server</li>
</ol>
<p><a class="glightbox" href="../images/2023-09-04-10-27-28.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-10-27-28.png" /></a></p>
<ol>
<li>Define <code>Sip Phone</code> on server and associate with end user. <code>Line</code> is important. It is used for <code>login</code> name on Sip client side.</li>
</ol>
<p><a class="glightbox" href="../images/2023-09-04-10-35-54.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-10-35-54.png" /></a>
<a class="glightbox" href="../images/2023-09-04-10-37-35.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-10-37-35.png" /></a></p>
<ol>
<li>Configure <code>Sip Device</code></li>
</ol>
<p><a class="glightbox" href="../images/2023-09-04-10-43-04.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-10-43-04.png" /></a></p>
<p>Lets analysis on wireshark</p>
<p><a class="glightbox" href="../images/2023-09-04-10-44-35.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-10-44-35.png" /></a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>REGISTER sip:192.168.80.100 SIP/2.0
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>Via: SIP/2.0/UDP 192.168.80.11:50952;rport;branch=z9hG4bKPj70cbe03dbec1454ab54854d64c772539
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>Route: &lt;sip:192.168.80.100;lr&gt;
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>Max-Forwards: 70
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>From: &lt;sip:10001@192.168.80.100&gt;;tag=4a349d82ef46410d8d78fae931640634
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>To: &lt;sip:10001@192.168.80.100&gt;
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>Call-ID: 26a8f5dd71574735a0224cee6701e1c5
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>CSeq: 24081 REGISTER
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>User-Agent: MicroSIP/3.21.3
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>Contact: &lt;sip:10001@192.168.80.11:50952;ob&gt;
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>Expires: 300
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>Content-Length:  0
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>SIP/2.0 100 Trying
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>Via: SIP/2.0/UDP 192.168.80.11:50952;rport;branch=z9hG4bKPj70cbe03dbec1454ab54854d64c772539
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>From: &lt;sip:10001@192.168.80.100&gt;;tag=4a349d82ef46410d8d78fae931640634
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>To: &lt;sip:10001@192.168.80.100&gt;
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>Date: Mon, 04 Sep 2023 07:28:23 GMT
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>Call-ID: 26a8f5dd71574735a0224cee6701e1c5
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>CSeq: 24081 REGISTER
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>Content-Length: 0
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>SIP/2.0 401 Unauthorized
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>Via: SIP/2.0/UDP 192.168.80.11:50952;rport;branch=z9hG4bKPj70cbe03dbec1454ab54854d64c772539
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>From: &lt;sip:10001@192.168.80.100&gt;;tag=4a349d82ef46410d8d78fae931640634
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>To: &lt;sip:10001@192.168.80.100&gt;;tag=1745811662
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>Date: Mon, 04 Sep 2023 07:28:23 GMT
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>Call-ID: 26a8f5dd71574735a0224cee6701e1c5
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>CSeq: 24081 REGISTER
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>WWW-Authenticate: Digest realm=&quot;ccmsipline&quot;, nonce=&quot;vP42jVSdIItGRD5nYmE71/4JD/ZYUQvL&quot;, algorithm=MD5
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>Content-Length: 0
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>REGISTER sip:192.168.80.100 SIP/2.0
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>Via: SIP/2.0/UDP 192.168.80.11:50952;rport;branch=z9hG4bKPjfd6662cd9ec944759b6778b30e77395b
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>Route: &lt;sip:192.168.80.100;lr&gt;
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>Max-Forwards: 70
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a>From: &lt;sip:10001@192.168.80.100&gt;;tag=4a349d82ef46410d8d78fae931640634
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a>To: &lt;sip:10001@192.168.80.100&gt;
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a>Call-ID: 26a8f5dd71574735a0224cee6701e1c5
</span><span id="__span-15-41"><a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a>CSeq: 24082 REGISTER
</span><span id="__span-15-42"><a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a>User-Agent: MicroSIP/3.21.3
</span><span id="__span-15-43"><a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a>Contact: &lt;sip:10001@192.168.80.11:50952;ob&gt;
</span><span id="__span-15-44"><a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a>Expires: 300
</span><span id="__span-15-45"><a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
</span><span id="__span-15-46"><a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a>Authorization: Digest username=&quot;microsip01&quot;, realm=&quot;ccmsipline&quot;, nonce=&quot;vP42jVSdIItGRD5nYmE71/4JD/ZYUQvL&quot;, uri=&quot;sip:192.168.80.100&quot;, response=&quot;b70fca7c592084c62c51f1a5143ea339&quot;, algorithm=MD5
</span><span id="__span-15-47"><a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a>Content-Length:  0
</span><span id="__span-15-48"><a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a>
</span><span id="__span-15-49"><a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a>SIP/2.0 100 Trying
</span><span id="__span-15-50"><a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a>Via: SIP/2.0/UDP 192.168.80.11:50952;rport;branch=z9hG4bKPjfd6662cd9ec944759b6778b30e77395b
</span><span id="__span-15-51"><a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a>From: &lt;sip:10001@192.168.80.100&gt;;tag=4a349d82ef46410d8d78fae931640634
</span><span id="__span-15-52"><a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a>To: &lt;sip:10001@192.168.80.100&gt;;tag=1745811662
</span><span id="__span-15-53"><a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a>Date: Mon, 04 Sep 2023 07:28:23 GMT
</span><span id="__span-15-54"><a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a>Call-ID: 26a8f5dd71574735a0224cee6701e1c5
</span><span id="__span-15-55"><a id="__codelineno-15-55" name="__codelineno-15-55" href="#__codelineno-15-55"></a>CSeq: 24082 REGISTER
</span><span id="__span-15-56"><a id="__codelineno-15-56" name="__codelineno-15-56" href="#__codelineno-15-56"></a>Content-Length: 0
</span><span id="__span-15-57"><a id="__codelineno-15-57" name="__codelineno-15-57" href="#__codelineno-15-57"></a>
</span><span id="__span-15-58"><a id="__codelineno-15-58" name="__codelineno-15-58" href="#__codelineno-15-58"></a>SIP/2.0 200 OK
</span><span id="__span-15-59"><a id="__codelineno-15-59" name="__codelineno-15-59" href="#__codelineno-15-59"></a>Via: SIP/2.0/UDP 192.168.80.11:50952;rport;branch=z9hG4bKPjfd6662cd9ec944759b6778b30e77395b
</span><span id="__span-15-60"><a id="__codelineno-15-60" name="__codelineno-15-60" href="#__codelineno-15-60"></a>From: &lt;sip:10001@192.168.80.100&gt;;tag=4a349d82ef46410d8d78fae931640634
</span><span id="__span-15-61"><a id="__codelineno-15-61" name="__codelineno-15-61" href="#__codelineno-15-61"></a>To: &lt;sip:10001@192.168.80.100&gt;;tag=1745811662
</span><span id="__span-15-62"><a id="__codelineno-15-62" name="__codelineno-15-62" href="#__codelineno-15-62"></a>Date: Mon, 04 Sep 2023 07:28:23 GMT
</span><span id="__span-15-63"><a id="__codelineno-15-63" name="__codelineno-15-63" href="#__codelineno-15-63"></a>Call-ID: 26a8f5dd71574735a0224cee6701e1c5
</span><span id="__span-15-64"><a id="__codelineno-15-64" name="__codelineno-15-64" href="#__codelineno-15-64"></a>Server: Cisco-CUCM14.0
</span><span id="__span-15-65"><a id="__codelineno-15-65" name="__codelineno-15-65" href="#__codelineno-15-65"></a>CSeq: 24082 REGISTER
</span><span id="__span-15-66"><a id="__codelineno-15-66" name="__codelineno-15-66" href="#__codelineno-15-66"></a>Expires: 120
</span><span id="__span-15-67"><a id="__codelineno-15-67" name="__codelineno-15-67" href="#__codelineno-15-67"></a>Contact: &lt;sip:10001@192.168.80.11:50952;ob&gt;;x-cisco-newreg
</span><span id="__span-15-68"><a id="__codelineno-15-68" name="__codelineno-15-68" href="#__codelineno-15-68"></a>Supported: X-cisco-sis-10.0.0
</span><span id="__span-15-69"><a id="__codelineno-15-69" name="__codelineno-15-69" href="#__codelineno-15-69"></a>Content-Length: 0
</span><span id="__span-15-70"><a id="__codelineno-15-70" name="__codelineno-15-70" href="#__codelineno-15-70"></a>
</span><span id="__span-15-71"><a id="__codelineno-15-71" name="__codelineno-15-71" href="#__codelineno-15-71"></a>NOTIFY sip:10001@192.168.80.11:50952;ob SIP/2.0
</span><span id="__span-15-72"><a id="__codelineno-15-72" name="__codelineno-15-72" href="#__codelineno-15-72"></a>Via: SIP/2.0/UDP 192.168.80.100:5060;branch=z9hG4bK2cc6917b371
</span><span id="__span-15-73"><a id="__codelineno-15-73" name="__codelineno-15-73" href="#__codelineno-15-73"></a>From: &lt;sip:10001@192.168.80.100&gt;;tag=1676257482
</span><span id="__span-15-74"><a id="__codelineno-15-74" name="__codelineno-15-74" href="#__codelineno-15-74"></a>To: &lt;sip:10001@192.168.80.11&gt;
</span><span id="__span-15-75"><a id="__codelineno-15-75" name="__codelineno-15-75" href="#__codelineno-15-75"></a>Call-ID: 9fdc4b00-1ef168f7-2ad-6450a8c0@192.168.80.100
</span><span id="__span-15-76"><a id="__codelineno-15-76" name="__codelineno-15-76" href="#__codelineno-15-76"></a>CSeq: 101 NOTIFY
</span><span id="__span-15-77"><a id="__codelineno-15-77" name="__codelineno-15-77" href="#__codelineno-15-77"></a>Max-Forwards: 70
</span><span id="__span-15-78"><a id="__codelineno-15-78" name="__codelineno-15-78" href="#__codelineno-15-78"></a>Date: Mon, 04 Sep 2023 07:28:23 GMT
</span><span id="__span-15-79"><a id="__codelineno-15-79" name="__codelineno-15-79" href="#__codelineno-15-79"></a>User-Agent: Cisco-CUCM14.0
</span><span id="__span-15-80"><a id="__codelineno-15-80" name="__codelineno-15-80" href="#__codelineno-15-80"></a>Event: message-summary
</span><span id="__span-15-81"><a id="__codelineno-15-81" name="__codelineno-15-81" href="#__codelineno-15-81"></a>Subscription-State: active
</span><span id="__span-15-82"><a id="__codelineno-15-82" name="__codelineno-15-82" href="#__codelineno-15-82"></a>Contact: &lt;sip:10001@192.168.80.100:5060&gt;
</span><span id="__span-15-83"><a id="__codelineno-15-83" name="__codelineno-15-83" href="#__codelineno-15-83"></a>Content-Type: application/simple-message-summary
</span><span id="__span-15-84"><a id="__codelineno-15-84" name="__codelineno-15-84" href="#__codelineno-15-84"></a>Content-Length: 22
</span><span id="__span-15-85"><a id="__codelineno-15-85" name="__codelineno-15-85" href="#__codelineno-15-85"></a>
</span><span id="__span-15-86"><a id="__codelineno-15-86" name="__codelineno-15-86" href="#__codelineno-15-86"></a>Messages-Waiting: no
</span></code></pre></div>
<p><mark>Attention :</mark> Sip device attempt with <code>Register</code> method two times. The second REGISTER includes a new header Authorization which contains the username, nonce and the response which is the overmentioned hash created from nonce  user and password in order to prevent the password from traveling in plaintext format over the internet. </p>
<p>As we mention before CUCM use <code>delay offer</code> lets test it with registered sip phone. For this testting we need another defination on cucm to redirect call to out of CUCM. Our test flow is like below:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>                                   ┌───────┐
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>┌─────────────┐     Register       │       │       Trunk        ┌─────────────┐
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>│ Micro SIP 1 ├────────────────────┤  PBX  ├────────────────────┤ Micro SIP 2 │
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>└─────────────┘                    │       │                    └─────────────┘
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>     10001                         └───────┘                         10002
</span></code></pre></div>
<p>Lets define <code>route pattern</code> on cucm. It is like static route. If you want to redirect call, you need basicly two things :</p>
<ol>
<li>Trunk to destination</li>
</ol>
<p><a class="glightbox" href="../images/2023-09-04-11-22-40.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-11-22-40.png" /></a>
<a class="glightbox" href="../images/2023-09-04-11-23-46.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-11-23-46.png" /></a></p>
<ol>
<li>Redirect for the pattern. Call Routing &gt; Route Hunt &gt; Route Pattern</li>
</ol>
<p><a class="glightbox" href="../images/2023-09-04-11-26-18.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-11-26-18.png" /></a></p>
<p>there is a extra configuration here for Micro SIP. Micro SIP uses <code>UDP</code> but cucm use <code>TCP</code>. We should change on cucm with <code>sip trunk security profile</code> then use this profile on trunk to Micro SIP like below:</p>
<p><a class="glightbox" href="../images/2023-09-04-11-32-06.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-11-32-06.png" /></a>
<a class="glightbox" href="../images/2023-09-04-11-35-37.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-11-35-37.png" /></a></p>
<p>Lets call from 10001 to 10002 and analysis delay offer or not.</p>
<p><a class="glightbox" href="../images/2023-09-04-11-37-55.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-11-37-55.png" /></a></p>
<p>there are two important things here one of them is call is delay offer that means SDP is not in invite, the other thing is call is not from microSIP-1 it is from Cucm by signalling. But if we use <code>sip or rtp</code> as display filter we will see that media flow is between microSIP-1 and microSIP-2.</p>
<p><a class="glightbox" href="../images/2023-09-04-11-41-48.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-11-41-48.png" /></a></p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>                                  Media Flow
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>       ┌────────────────────────────────────────────────────────────────┐
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>       │                                                                │
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>       │                           ┌───────┐                            │
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>┌──────▼──────┐                    │       │                    ┌───────▼─────┐
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>│ Micro SIP 1 ◄─────Signalling──── ► PBX   ◄────Signalling──────► Micro SIP 2 │
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>└─────────────┘                    │       │                    └─────────────┘
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>   10001                           └───────┘                        10002
</span></code></pre></div>
<strong>Refer Method</strong></p>
<p><code>Refer Method</code> define in <a href="https://www.ietf.org/rfc/rfc3515.txt">rfc3515</a> uses for call transfer. Lets analysis on lab like below:</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>                                   ┌───────┐
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>┌─────────────┐                    │       │                    ┌─────────────┐
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>│ Micro SIP 1 ◄───── Register ─────►  PBX  ◄────── Trunk ───────► Micro SIP 2 │
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>└─────────────┘                    │       │                    └─────────────┘
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>   10001                           └───▲───┘                        10002
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>                                       │
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>┌───────────────────────────────┐      │
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>│ 10002 calls to 10001,         │      │
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>│ 10001 transfer calls to 10003 │      │                        ┌─────────────┐
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>└───────────────────────────────┘      └───────────Trunk────────► Micro SIP 3 │
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>                                                                └─────────────┘
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>                                                                    10003
</span></code></pre></div>
Capture from Micro SIP 1:</p>
<p><a class="glightbox" href="../images/2023-09-04-12-57-25.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-12-57-25.png" /></a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>INVITE sip:10001@192.168.80.11:50952;ob SIP/2.0
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>Via: SIP/2.0/UDP 192.168.80.100:5060;branch=z9hG4bK3661c5dc56f
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>From: &lt;sip:192.168.80.100&gt;;tag=22130~27aa66c8-2714-422d-b044-24d65024d146-29314073
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>To: &lt;sip:10001@192.168.80.100&gt;
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>Date: Mon, 04 Sep 2023 09:50:43 GMT
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>Call-ID: 8218e100-1ef1690b-2dc-6450a8c0@192.168.80.100
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>Supported: timer,resource-priority,replaces
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>Min-SE:  1800
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>User-Agent: Cisco-CUCM14.0
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>Allow: INVITE, OPTIONS, INFO, BYE, CANCEL, ACK, PRACK, UPDATE, REFER, SUBSCRIBE, NOTIFY
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>CSeq: 101 INVITE
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>Expires: 180
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>Allow-Events: presence
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>Send-Info: conference, x-cisco-conference
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>Alert-Info: &lt;file://Bellcore-dr2/&gt;
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>Session-ID: 87881cd24ddf6a92abd7cfe7eab22129;remote=00000000000000000000000000000000
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>Remote-Party-ID: &lt;sip:192.168.80.100&gt;;party=calling;screen=yes;privacy=off
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>Contact: &lt;sip:192.168.80.100:5060&gt;
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>Max-Forwards: 69
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>Content-Length: 0
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>SIP/2.0 100 Trying
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>Via: SIP/2.0/UDP 192.168.80.100:5060;received=192.168.80.100;branch=z9hG4bK3661c5dc56f
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>Call-ID: 8218e100-1ef1690b-2dc-6450a8c0@192.168.80.100
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>From: &lt;sip:192.168.80.100&gt;;tag=22130~27aa66c8-2714-422d-b044-24d65024d146-29314073
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>To: &lt;sip:10001@192.168.80.100&gt;
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>CSeq: 101 INVITE
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>Content-Length:  0
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>SIP/2.0 180 Ringing
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>Via: SIP/2.0/UDP 192.168.80.100:5060;received=192.168.80.100;branch=z9hG4bK3661c5dc56f
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a>Call-ID: 8218e100-1ef1690b-2dc-6450a8c0@192.168.80.100
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a>From: &lt;sip:192.168.80.100&gt;;tag=22130~27aa66c8-2714-422d-b044-24d65024d146-29314073
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a>To: &lt;sip:10001@192.168.80.100&gt;;tag=5613b666f44041689c0c96620ef7e026
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a>CSeq: 101 INVITE
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a>Contact: &lt;sip:10001@192.168.80.11:50952;ob&gt;
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a>Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
</span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a>Content-Length:  0
</span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a>
</span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a>SIP/2.0 200 OK
</span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a>Via: SIP/2.0/UDP 192.168.80.100:5060;received=192.168.80.100;branch=z9hG4bK3661c5dc56f
</span><span id="__span-19-42"><a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a>Call-ID: 8218e100-1ef1690b-2dc-6450a8c0@192.168.80.100
</span><span id="__span-19-43"><a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a>From: &lt;sip:192.168.80.100&gt;;tag=22130~27aa66c8-2714-422d-b044-24d65024d146-29314073
</span><span id="__span-19-44"><a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a>To: &lt;sip:10001@192.168.80.100&gt;;tag=5613b666f44041689c0c96620ef7e026
</span><span id="__span-19-45"><a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a>CSeq: 101 INVITE
</span><span id="__span-19-46"><a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a>Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
</span><span id="__span-19-47"><a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a>Contact: &lt;sip:10001@192.168.80.11:50952;ob&gt;
</span><span id="__span-19-48"><a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a>Supported: replaces, 100rel, timer, norefersub
</span><span id="__span-19-49"><a id="__codelineno-19-49" name="__codelineno-19-49" href="#__codelineno-19-49"></a>Content-Type: application/sdp
</span><span id="__span-19-50"><a id="__codelineno-19-50" name="__codelineno-19-50" href="#__codelineno-19-50"></a>Content-Length:   387
</span><span id="__span-19-51"><a id="__codelineno-19-51" name="__codelineno-19-51" href="#__codelineno-19-51"></a>
</span><span id="__span-19-52"><a id="__codelineno-19-52" name="__codelineno-19-52" href="#__codelineno-19-52"></a>v=0
</span><span id="__span-19-53"><a id="__codelineno-19-53" name="__codelineno-19-53" href="#__codelineno-19-53"></a>o=- 3902820845 3902820845 IN IP4 192.168.71.146
</span><span id="__span-19-54"><a id="__codelineno-19-54" name="__codelineno-19-54" href="#__codelineno-19-54"></a>s=pjmedia
</span><span id="__span-19-55"><a id="__codelineno-19-55" name="__codelineno-19-55" href="#__codelineno-19-55"></a>b=AS:84
</span><span id="__span-19-56"><a id="__codelineno-19-56" name="__codelineno-19-56" href="#__codelineno-19-56"></a>t=0 0
</span><span id="__span-19-57"><a id="__codelineno-19-57" name="__codelineno-19-57" href="#__codelineno-19-57"></a>a=X-nat:0
</span><span id="__span-19-58"><a id="__codelineno-19-58" name="__codelineno-19-58" href="#__codelineno-19-58"></a>m=audio 4028 RTP/AVP 8 0 101
</span><span id="__span-19-59"><a id="__codelineno-19-59" name="__codelineno-19-59" href="#__codelineno-19-59"></a>c=IN IP4 192.168.71.146
</span><span id="__span-19-60"><a id="__codelineno-19-60" name="__codelineno-19-60" href="#__codelineno-19-60"></a>b=TIAS:64000
</span><span id="__span-19-61"><a id="__codelineno-19-61" name="__codelineno-19-61" href="#__codelineno-19-61"></a>a=rtcp:4029 IN IP4 192.168.71.146
</span><span id="__span-19-62"><a id="__codelineno-19-62" name="__codelineno-19-62" href="#__codelineno-19-62"></a>a=sendrecv
</span><span id="__span-19-63"><a id="__codelineno-19-63" name="__codelineno-19-63" href="#__codelineno-19-63"></a>a=rtpmap:8 PCMA/8000
</span><span id="__span-19-64"><a id="__codelineno-19-64" name="__codelineno-19-64" href="#__codelineno-19-64"></a>a=rtpmap:0 PCMU/8000
</span><span id="__span-19-65"><a id="__codelineno-19-65" name="__codelineno-19-65" href="#__codelineno-19-65"></a>a=rtpmap:101 telephone-event/8000
</span><span id="__span-19-66"><a id="__codelineno-19-66" name="__codelineno-19-66" href="#__codelineno-19-66"></a>a=fmtp:101 0-16
</span><span id="__span-19-67"><a id="__codelineno-19-67" name="__codelineno-19-67" href="#__codelineno-19-67"></a>a=ssrc:917066532 cname:3f6028542ff246d5
</span><span id="__span-19-68"><a id="__codelineno-19-68" name="__codelineno-19-68" href="#__codelineno-19-68"></a>m=video 0 RTP/AVP 31
</span><span id="__span-19-69"><a id="__codelineno-19-69" name="__codelineno-19-69" href="#__codelineno-19-69"></a>c=IN IP4 127.0.0.1
</span><span id="__span-19-70"><a id="__codelineno-19-70" name="__codelineno-19-70" href="#__codelineno-19-70"></a>ACK sip:10001@192.168.80.11:50952;ob SIP/2.0
</span><span id="__span-19-71"><a id="__codelineno-19-71" name="__codelineno-19-71" href="#__codelineno-19-71"></a>Via: SIP/2.0/UDP 192.168.80.100:5060;branch=z9hG4bK367239bc604
</span><span id="__span-19-72"><a id="__codelineno-19-72" name="__codelineno-19-72" href="#__codelineno-19-72"></a>From: &lt;sip:192.168.80.100&gt;;tag=22130~27aa66c8-2714-422d-b044-24d65024d146-29314073
</span><span id="__span-19-73"><a id="__codelineno-19-73" name="__codelineno-19-73" href="#__codelineno-19-73"></a>To: &lt;sip:10001@192.168.80.100&gt;;tag=5613b666f44041689c0c96620ef7e026
</span><span id="__span-19-74"><a id="__codelineno-19-74" name="__codelineno-19-74" href="#__codelineno-19-74"></a>Date: Mon, 04 Sep 2023 09:50:43 GMT
</span><span id="__span-19-75"><a id="__codelineno-19-75" name="__codelineno-19-75" href="#__codelineno-19-75"></a>Call-ID: 8218e100-1ef1690b-2dc-6450a8c0@192.168.80.100
</span><span id="__span-19-76"><a id="__codelineno-19-76" name="__codelineno-19-76" href="#__codelineno-19-76"></a>User-Agent: Cisco-CUCM14.0
</span><span id="__span-19-77"><a id="__codelineno-19-77" name="__codelineno-19-77" href="#__codelineno-19-77"></a>Max-Forwards: 70
</span><span id="__span-19-78"><a id="__codelineno-19-78" name="__codelineno-19-78" href="#__codelineno-19-78"></a>CSeq: 101 ACK
</span><span id="__span-19-79"><a id="__codelineno-19-79" name="__codelineno-19-79" href="#__codelineno-19-79"></a>Allow-Events: presence
</span><span id="__span-19-80"><a id="__codelineno-19-80" name="__codelineno-19-80" href="#__codelineno-19-80"></a>Session-ID: 87881cd24ddf6a92abd7cfe7eab22129;remote=a3a189dd08a5f9750c5045c3eaa22130
</span><span id="__span-19-81"><a id="__codelineno-19-81" name="__codelineno-19-81" href="#__codelineno-19-81"></a>Content-Type: application/sdp
</span><span id="__span-19-82"><a id="__codelineno-19-82" name="__codelineno-19-82" href="#__codelineno-19-82"></a>Content-Length: 420
</span><span id="__span-19-83"><a id="__codelineno-19-83" name="__codelineno-19-83" href="#__codelineno-19-83"></a>
</span><span id="__span-19-84"><a id="__codelineno-19-84" name="__codelineno-19-84" href="#__codelineno-19-84"></a>v=0
</span><span id="__span-19-85"><a id="__codelineno-19-85" name="__codelineno-19-85" href="#__codelineno-19-85"></a>o=CiscoSystemsCCM-SIP 22130 1 IN IP4 192.168.80.100
</span><span id="__span-19-86"><a id="__codelineno-19-86" name="__codelineno-19-86" href="#__codelineno-19-86"></a>s=SIP Call
</span><span id="__span-19-87"><a id="__codelineno-19-87" name="__codelineno-19-87" href="#__codelineno-19-87"></a>c=IN IP4 192.168.80.12
</span><span id="__span-19-88"><a id="__codelineno-19-88" name="__codelineno-19-88" href="#__codelineno-19-88"></a>b=AS:80
</span><span id="__span-19-89"><a id="__codelineno-19-89" name="__codelineno-19-89" href="#__codelineno-19-89"></a>t=0 0
</span><span id="__span-19-90"><a id="__codelineno-19-90" name="__codelineno-19-90" href="#__codelineno-19-90"></a>m=audio 4070 RTP/AVP 0 101
</span><span id="__span-19-91"><a id="__codelineno-19-91" name="__codelineno-19-91" href="#__codelineno-19-91"></a>b=TIAS:64000
</span><span id="__span-19-92"><a id="__codelineno-19-92" name="__codelineno-19-92" href="#__codelineno-19-92"></a>a=rtpmap:0 PCMU/8000
</span><span id="__span-19-93"><a id="__codelineno-19-93" name="__codelineno-19-93" href="#__codelineno-19-93"></a>a=rtpmap:101 telephone-event/8000
</span><span id="__span-19-94"><a id="__codelineno-19-94" name="__codelineno-19-94" href="#__codelineno-19-94"></a>a=fmtp:101 0-15
</span><span id="__span-19-95"><a id="__codelineno-19-95" name="__codelineno-19-95" href="#__codelineno-19-95"></a>a=rtcp:4071 IN IP4 192.168.80.12
</span><span id="__span-19-96"><a id="__codelineno-19-96" name="__codelineno-19-96" href="#__codelineno-19-96"></a>m=video 0 RTP/AVP 31 34 96 97
</span><span id="__span-19-97"><a id="__codelineno-19-97" name="__codelineno-19-97" href="#__codelineno-19-97"></a>a=rtpmap:31 H261/90000
</span><span id="__span-19-98"><a id="__codelineno-19-98" name="__codelineno-19-98" href="#__codelineno-19-98"></a>a=rtpmap:34 H263/90000
</span><span id="__span-19-99"><a id="__codelineno-19-99" name="__codelineno-19-99" href="#__codelineno-19-99"></a>a=rtpmap:96 H263-1998/90000
</span><span id="__span-19-100"><a id="__codelineno-19-100" name="__codelineno-19-100" href="#__codelineno-19-100"></a>a=rtpmap:97 H264/90000
</span><span id="__span-19-101"><a id="__codelineno-19-101" name="__codelineno-19-101" href="#__codelineno-19-101"></a>a=content:main
</span><span id="__span-19-102"><a id="__codelineno-19-102" name="__codelineno-19-102" href="#__codelineno-19-102"></a>a=inactive
</span><span id="__span-19-103"><a id="__codelineno-19-103" name="__codelineno-19-103" href="#__codelineno-19-103"></a>
</span><span id="__span-19-104"><a id="__codelineno-19-104" name="__codelineno-19-104" href="#__codelineno-19-104"></a>REFER sip:192.168.80.100:5060 SIP/2.0
</span><span id="__span-19-105"><a id="__codelineno-19-105" name="__codelineno-19-105" href="#__codelineno-19-105"></a>Via: SIP/2.0/UDP 192.168.80.11:50952;rport;branch=z9hG4bKPjf655869cdc6842058ffb2cc963f82a6e
</span><span id="__span-19-106"><a id="__codelineno-19-106" name="__codelineno-19-106" href="#__codelineno-19-106"></a>Max-Forwards: 70
</span><span id="__span-19-107"><a id="__codelineno-19-107" name="__codelineno-19-107" href="#__codelineno-19-107"></a>From: &lt;sip:10001@192.168.80.100&gt;;tag=5613b666f44041689c0c96620ef7e026
</span><span id="__span-19-108"><a id="__codelineno-19-108" name="__codelineno-19-108" href="#__codelineno-19-108"></a>To: &lt;sip:192.168.80.100&gt;;tag=22130~27aa66c8-2714-422d-b044-24d65024d146-29314073
</span><span id="__span-19-109"><a id="__codelineno-19-109" name="__codelineno-19-109" href="#__codelineno-19-109"></a>Contact: &lt;sip:10001@192.168.80.11:50952;ob&gt;
</span><span id="__span-19-110"><a id="__codelineno-19-110" name="__codelineno-19-110" href="#__codelineno-19-110"></a>Call-ID: 8218e100-1ef1690b-2dc-6450a8c0@192.168.80.100
</span><span id="__span-19-111"><a id="__codelineno-19-111" name="__codelineno-19-111" href="#__codelineno-19-111"></a>CSeq: 15038 REFER
</span><span id="__span-19-112"><a id="__codelineno-19-112" name="__codelineno-19-112" href="#__codelineno-19-112"></a>Event: refer
</span><span id="__span-19-113"><a id="__codelineno-19-113" name="__codelineno-19-113" href="#__codelineno-19-113"></a>Expires: 600
</span><span id="__span-19-114"><a id="__codelineno-19-114" name="__codelineno-19-114" href="#__codelineno-19-114"></a>Supported: replaces, 100rel, timer, norefersub, trickle-ice
</span><span id="__span-19-115"><a id="__codelineno-19-115" name="__codelineno-19-115" href="#__codelineno-19-115"></a>Accept: message/sipfrag;version=2.0
</span><span id="__span-19-116"><a id="__codelineno-19-116" name="__codelineno-19-116" href="#__codelineno-19-116"></a>Allow-Events: presence, message-summary, refer
</span><span id="__span-19-117"><a id="__codelineno-19-117" name="__codelineno-19-117" href="#__codelineno-19-117"></a>Refer-To: &lt;sip:10003@192.168.80.100&gt;
</span><span id="__span-19-118"><a id="__codelineno-19-118" name="__codelineno-19-118" href="#__codelineno-19-118"></a>Referred-By: &lt;sip:10001@192.168.80.100&gt;
</span><span id="__span-19-119"><a id="__codelineno-19-119" name="__codelineno-19-119" href="#__codelineno-19-119"></a>User-Agent: MicroSIP/3.21.3
</span><span id="__span-19-120"><a id="__codelineno-19-120" name="__codelineno-19-120" href="#__codelineno-19-120"></a>Content-Length:  0
</span><span id="__span-19-121"><a id="__codelineno-19-121" name="__codelineno-19-121" href="#__codelineno-19-121"></a>
</span><span id="__span-19-122"><a id="__codelineno-19-122" name="__codelineno-19-122" href="#__codelineno-19-122"></a>SIP/2.0 202 Accepted
</span><span id="__span-19-123"><a id="__codelineno-19-123" name="__codelineno-19-123" href="#__codelineno-19-123"></a>Via: SIP/2.0/UDP 192.168.80.11:50952;rport;branch=z9hG4bKPjf655869cdc6842058ffb2cc963f82a6e
</span><span id="__span-19-124"><a id="__codelineno-19-124" name="__codelineno-19-124" href="#__codelineno-19-124"></a>From: &lt;sip:10001@192.168.80.100&gt;;tag=5613b666f44041689c0c96620ef7e026
</span><span id="__span-19-125"><a id="__codelineno-19-125" name="__codelineno-19-125" href="#__codelineno-19-125"></a>To: &lt;sip:192.168.80.100&gt;;tag=22130~27aa66c8-2714-422d-b044-24d65024d146-29314073
</span><span id="__span-19-126"><a id="__codelineno-19-126" name="__codelineno-19-126" href="#__codelineno-19-126"></a>Date: Mon, 04 Sep 2023 09:51:00 GMT
</span><span id="__span-19-127"><a id="__codelineno-19-127" name="__codelineno-19-127" href="#__codelineno-19-127"></a>Call-ID: 8218e100-1ef1690b-2dc-6450a8c0@192.168.80.100
</span><span id="__span-19-128"><a id="__codelineno-19-128" name="__codelineno-19-128" href="#__codelineno-19-128"></a>Server: Cisco-CUCM14.0
</span><span id="__span-19-129"><a id="__codelineno-19-129" name="__codelineno-19-129" href="#__codelineno-19-129"></a>CSeq: 15038 REFER
</span><span id="__span-19-130"><a id="__codelineno-19-130" name="__codelineno-19-130" href="#__codelineno-19-130"></a>Contact: &lt;sip:192.168.80.100:5060&gt;
</span><span id="__span-19-131"><a id="__codelineno-19-131" name="__codelineno-19-131" href="#__codelineno-19-131"></a>Content-Length: 0
</span><span id="__span-19-132"><a id="__codelineno-19-132" name="__codelineno-19-132" href="#__codelineno-19-132"></a>
</span><span id="__span-19-133"><a id="__codelineno-19-133" name="__codelineno-19-133" href="#__codelineno-19-133"></a>
</span><span id="__span-19-134"><a id="__codelineno-19-134" name="__codelineno-19-134" href="#__codelineno-19-134"></a>BYE sip:10001@192.168.80.11:50952;ob SIP/2.0
</span><span id="__span-19-135"><a id="__codelineno-19-135" name="__codelineno-19-135" href="#__codelineno-19-135"></a>Via: SIP/2.0/UDP 192.168.80.100:5060;branch=z9hG4bK36f67f779d
</span><span id="__span-19-136"><a id="__codelineno-19-136" name="__codelineno-19-136" href="#__codelineno-19-136"></a>From: &lt;sip:192.168.80.100&gt;;tag=22130~27aa66c8-2714-422d-b044-24d65024d146-29314073
</span><span id="__span-19-137"><a id="__codelineno-19-137" name="__codelineno-19-137" href="#__codelineno-19-137"></a>To: &lt;sip:10001@192.168.80.100&gt;;tag=5613b666f44041689c0c96620ef7e026
</span><span id="__span-19-138"><a id="__codelineno-19-138" name="__codelineno-19-138" href="#__codelineno-19-138"></a>Date: Mon, 04 Sep 2023 09:51:00 GMT
</span><span id="__span-19-139"><a id="__codelineno-19-139" name="__codelineno-19-139" href="#__codelineno-19-139"></a>Call-ID: 8218e100-1ef1690b-2dc-6450a8c0@192.168.80.100
</span><span id="__span-19-140"><a id="__codelineno-19-140" name="__codelineno-19-140" href="#__codelineno-19-140"></a>User-Agent: Cisco-CUCM14.0
</span><span id="__span-19-141"><a id="__codelineno-19-141" name="__codelineno-19-141" href="#__codelineno-19-141"></a>Max-Forwards: 70
</span><span id="__span-19-142"><a id="__codelineno-19-142" name="__codelineno-19-142" href="#__codelineno-19-142"></a>CSeq: 102 BYE
</span><span id="__span-19-143"><a id="__codelineno-19-143" name="__codelineno-19-143" href="#__codelineno-19-143"></a>Session-ID: 87881cd24ddf6a92abd7cfe7eab22129;remote=a3a189dd08a5f9750c5045c3eaa22130
</span><span id="__span-19-144"><a id="__codelineno-19-144" name="__codelineno-19-144" href="#__codelineno-19-144"></a>Content-Length: 0
</span><span id="__span-19-145"><a id="__codelineno-19-145" name="__codelineno-19-145" href="#__codelineno-19-145"></a>
</span><span id="__span-19-146"><a id="__codelineno-19-146" name="__codelineno-19-146" href="#__codelineno-19-146"></a>SIP/2.0 200 OK
</span><span id="__span-19-147"><a id="__codelineno-19-147" name="__codelineno-19-147" href="#__codelineno-19-147"></a>Via: SIP/2.0/UDP 192.168.80.100:5060;received=192.168.80.100;branch=z9hG4bK36f67f779d
</span><span id="__span-19-148"><a id="__codelineno-19-148" name="__codelineno-19-148" href="#__codelineno-19-148"></a>Call-ID: 8218e100-1ef1690b-2dc-6450a8c0@192.168.80.100
</span><span id="__span-19-149"><a id="__codelineno-19-149" name="__codelineno-19-149" href="#__codelineno-19-149"></a>From: &lt;sip:192.168.80.100&gt;;tag=22130~27aa66c8-2714-422d-b044-24d65024d146-29314073
</span><span id="__span-19-150"><a id="__codelineno-19-150" name="__codelineno-19-150" href="#__codelineno-19-150"></a>To: &lt;sip:10001@192.168.80.100&gt;;tag=5613b666f44041689c0c96620ef7e026
</span><span id="__span-19-151"><a id="__codelineno-19-151" name="__codelineno-19-151" href="#__codelineno-19-151"></a>CSeq: 102 BYE
</span><span id="__span-19-152"><a id="__codelineno-19-152" name="__codelineno-19-152" href="#__codelineno-19-152"></a>Content-Length:  0
</span></code></pre></div>
<p><strong>SIP Response Code</strong></p>
<p>There are six SIP response code class types—the first digit of each code indicates the class of the code. Codes beginning with the number 1 are known as “provisional” codes, and codes beginning with numbers 2-6 are known as “final” codes. Provisional codes are sent up until a call is connected; final codes confirm whether or not the connection was successful.</p>
<p>You don’t need to memorize the different types of SIP codes, but it can be helpful to have a reference sheet handy and a general idea of what each code indicates.</p>
<p><mark>List of SIP Response Codes</mark></p>
<p><strong>1xx - Informational SIP Responses</strong></p>
<p>100 Trying – An extended search is being performed so a forking proxy must send a 100 Trying response.
180 Ringing – The Destination User Agent has received the INVITE message and is alerting the user of call.
181 Call Is Being Forwarded – Optional, send by Server to indicate a call is being forwarded.
182 Queued – Destination was temporarily unavailable, the server has queued the call until destination is available.
183 Session Progress – This response may be used to send extra information for a call which is still being set up.
199 Early Dialog Terminated – Send by the User Agent Server to indicate that an early dialog has been terminated.</p>
<p><strong>2xx - Success Responses</strong></p>
<p>200 OK – Shows that the request was successful
202 Accepted – Indicates that the request has been accepted for processing, mainly used for referrals.
204 No Notification – Indicates that the request was successful but no response will be received.
3xx - Redirection Responses
300 Multiple Choices – The address resolved to one of several options for the client to choose.
301 Moved Permanently – The original Request URI is no longer valid, the new address is given in the Contact header.
302 Moved Temporarily – The client should try at the address in the Contact field.
305 Use Proxy – The Contact field details a proxy that must be used to access the requested destination.
380 Alternative Service – The call failed, but alternatives are detailed in the message body.</p>
<p><strong>4xx - Request Failures</strong></p>
<p>400 Bad Request – The request could not be understood due to malformed syntax.
401 Unauthorized – The request requires user authentication. Only issued by registrars. NOTE: Proxies should use proxy authorization 407.
402 Payment Required – (reserved for future use).
403 Forbidden
404 Not Found – (User not found).
405 Method Not Allowed
406 Not Acceptable
407 Proxy Authentication Required – The request requires user authentication.
408 Request Timeout – Could not find the user in allowable time.
409 Conflict
410 Gone – The user existed once, but is not available here any more.
411 Length Required – The server will not accept the request without a valid content length (deprecated).
413 Request Entity Too Large – Request body too large.
414 Request URI Too Long – The server refuses to service the request. The Req-URI is longer than the server can interpret.
415 Unsupported Media Type
416 Unsupported URI Scheme
417 Unknown Resource-Priority – There was a resource-priority option tag, but no Resource-Priority header.
420 Bad Extension – Bad SIP Protocol Extension used, not understood by the server.
421 Extension Required – The server needs a specific extension not listed in the Supported header.
422 Session Interval Too Small
423 Interval Too Brief
424 Bad Location Information
433 Anonymity Disallowed – The request has been rejected because it was anonymous.
480 Temporarily Unavailable – Callee currently unavailable.
481 Call/Transaction Does Not Exist
482 Loop Detected
483 Too Many Hops
484 Address Incomplete
485 Ambiguous
486 Busy Here – Callee is busy.
487 Request Terminated – The request terminated by a bye or cancel.
488 Not Acceptable Here
491 Request Pending – Server has some pending request from the same dialog.
493 Undecipherable – Could not decrypt MIME body part.
494 Security Agreement Required – The server has received a request that requires a negotiated security mechanism.</p>
<p><strong>5xx - Server Errors</strong></p>
<p>500 Server Internal Error – The server could not fulfill the request due to some unexpected condition.
501 Not Implemented – The SIP request method is not implemented here.
502 Bad Gateway
503 Service Unavailable
504 Server Time-out
505 Version Not Supported – The SIP protocol version in the request is not supported by the server.
513 Message Too Large</p>
<p><strong>6xx - Global Failures</strong></p>
<p>600 Busy Everywhere – All possible destinations are busy.
603 Decline – Destination cannot/doesn't wish to participate in the call, no alternative destinations.
604 Does Not Exist Anywhere – The server has authoritative information that the requested user does not exist anywhere.
606 Not Acceptable</p>
<h2 id="dtmf">DTMF</h2>
<p>DTMF (Dual Tone Multi-Frequency) has clearly been extended to purposes beyond simply dialing a telephone number. InteractiveVoiceSystems(IVR)promptusforallsortsofthingsthatweanswerwithbuttonpresses. We log into our voicemail systems and retrieve our messages with DTMF.</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>       ┌───────────────────────┐
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>       │         DTMF          │
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>       ├─────┬─────┬─────┬─────┤
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>697  ─►│  1  │  2  │  3  │  A  │
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>       ├─────┼─────┼─────┼─────┤
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>770  ─►│  4  │  5  │  6  │  B  │
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>       ├─────┼─────┼─────┼─────┤
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>852  ─►│  7  │  8  │  9  │  C  │
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>       ├─────┼─────┼─────┼─────┤
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>941  ─►│  *  │  0  │  #  │  D  │
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>       └─────┴─────┴─────┴─────┘
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>          ▲     ▲     ▲     ▲
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>          │     │     │     │
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>        1209  1336  1477  1633
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>    Standard DTMF Frequencies(Hz)
</span></code></pre></div>
DTMF wasn’t a problem with digital and analog telephone systems because they both use a toll quality (64 kilobit, 8000 Hz) audio connection. The tones and speech easily mixed with one another and tone detection hardware was able to separate the DTMF out for applications that required it.</p>
<p>• However, with VoIP and bandwidth concerns came voice compression and different techniques to send a legible voice stream using as little bytes as possible.
• With RFC 2833 you don’t send those DTMF signals on the same connection that you send your audio conversation.</p>
<p>DTMF is used two different type in VOIP:"in-band" and "out-of-band" DTMF (Dual-Tone Multi-Frequency) dialing:</p>
<ol>
<li><strong>In-Band DTMF Dialing</strong>:</li>
<li>"In-band" DTMF dialing refers to the transmission of DTMF tones within the same voice channel, meaning they are sent as part of the audio signal.</li>
<li>In this method, the DTMF tones dialed by the user are directly transmitted as part of the audio signal and can be heard by the human ear.</li>
<li>In-band DTMF dialing is commonly used on traditional telephone lines.</li>
<li>
<p>The disadvantage is that DTMF tones can mix with other sounds and potentially lead to inadvertent dialing.</p>
</li>
<li>
<p><strong>Out-of-Band DTMF Dialing</strong>:</p>
</li>
<li>"Out-of-band" DTMF dialing involves transmitting DTMF tones outside of the voice channel, typically using a separate data channel or signaling channel.</li>
<li>This method prevents DTMF tones from interfering with the audio signal and provides more reliable transmission.</li>
<li>Out-of-band DTMF dialing is more commonly used in VoIP (Voice over IP) and digital telephone networks.</li>
<li>The disadvantage is that it may require an additional signaling or data channel.</li>
</ol>
<p>In summary, in-band DTMF dialing is used on traditional telephone lines and some communication systems, while out-of-band DTMF dialing is more commonly preferred in modern digital communication infrastructures. The choice between these methods depends on the communication infrastructure and specific requirements.</p>
<p>Here are the commonly used DTMF (Dual-Tone Multi-Frequency) relay methods:</p>
<ol>
<li><strong>RFC 2833 (RTP Payload for DTMF Digits)</strong>:</li>
<li>RFC 2833 defines a method for relaying DTMF digits within the RTP (Real-time Transport Protocol) stream as a special payload. This allows DTMF digits to be transmitted outside of the audio channel, ensuring reliable transmission. RFC 2833 is frequently used in VoIP (Voice over IP) and digital communication networks.</li>
</ol>
<p><a class="glightbox" href="../images/2023-09-04-14-11-19.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-14-11-19.png" /></a>
   <a class="glightbox" href="../images/2023-09-04-14-31-53.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-14-31-53.png" /></a></p>
<ol>
<li><strong>SIP INFO Method</strong>:</li>
<li>The "SIP INFO" method is used in SIP (Session Initiation Protocol) to relay DTMF tones within SIP messages. This method carries DTMF tones as part of SIP messages and is commonly used in SIP-based communication systems.</li>
</ol>
<p><a class="glightbox" href="../images/2023-09-04-14-47-39.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-14-47-39.png" /></a>
   <a class="glightbox" href="../images/2023-09-04-14-56-08.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-14-56-08.png" /></a></p>
<ol>
<li><strong>In-Band DTMF Relay</strong>:</li>
<li>In-band DTMF relay refers to the method of transmitting DTMF tones <code>within the audio channel</code>. This means that DTMF tones are transmitted as part of the audio signal. It is often used on traditional phone lines, but DTMF tones can interfere with other sounds and potentially lead to errors.</li>
</ol>
<p><a class="glightbox" href="../images/2023-09-04-14-57-09.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-14-57-09.png" /></a>
   <a class="glightbox" href="../images/2023-09-04-15-03-53.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-15-03-53.png" /></a></p>
<ol>
<li><strong>H.245 Signal</strong>:</li>
<li>H.245 Signal is a method used in video conferencing systems that rely on the H.323 protocol. It allows for the transmission of DTMF tones as signals between H.323 devices.</li>
</ol>
<p>Each DTMF relay method can be compatible with specific communication infrastructures and protocols. The choice of which method to use depends on the characteristics of your communication systems and requirements. If you are using VoIP, SIP, H.323, or other communication protocols, you should select the appropriate DTMF relay method accordingly.</p>
<h2 id="ios-devices-and-sip">IOS Devices and SIP</h2>
<p>SIP (Session Initiation Protocol) is a protocol used for initiating, terminating, and managing communication sessions, particularly in Voice over IP (VoIP) applications. It plays a crucial role in facilitating communication between Cisco IOS (Internetwork Operating System) devices and other VoIP devices. Here's a description of the relationship between SIP protocol and Cisco IOS devices:</p>
<ul>
<li>Cisco IOS devices use the SIP protocol to initiate, terminate, and manage VoIP calls.</li>
<li>SIP is a fundamental protocol for call control in both voice and video communication.</li>
<li>Cisco devices establish communication using SIP by connecting to SIP servers or other SIP-based devices.</li>
<li>Cisco IOS devices use for <code>media resource</code> like conference bridge, media termination point, music on hold etc.</li>
</ul>
<p>cisco ios devices could act two different roles one of them is <code>voice gateway</code>, the second one is <code>session border controller</code> (SBC). 
In cisco terminology, SBC named as CUBE router, that means IP-to-IP gateway generally SIP-TO-SIP.</p>
<p>We need some configuration for this feature, lets getting deep for this situation.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>voice service voip
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>allow-connection sip to sip            --&gt; this enable ip to ip communication (sip to sip)
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>!
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>dial-peer voice 1000 voip              --&gt; this is virtual gate, uses for outgoing or incoming call
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a> session protocol sipv2                --&gt; this virtual gate uses sip not h323 etc.
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a> incoming called-number 1              --&gt; this dial-peer for calling &#39;1&#39;
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a> session target ipv4:192.168.80.11     --&gt; this dial-peer communicate with this ip
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a> codec g711ulaw                        --&gt; only accept g711ulaw codec (default value g729)
</span></code></pre></div>
<p>after this configuration, our ios device now accept call from outsite. Lets test it from MicroSIP device and enable <code>debug</code> on IOS devices with <code>debug ccsip message</code>.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>Received:
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>INVITE sip:1@192.168.80.254 SIP/2.0
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>Via: SIP/2.0/UDP 192.168.71.146:50555;rport;branch=z9hG4bKPj4c1fe50f616945f5b4b9c4a4103efcec
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>Max-Forwards: 70
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>From: &lt;sip:31.145.1.90&gt;;tag=3b1d7dd63c2e42238a89541c88118e5d
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>To: &lt;sip:1@192.168.80.254&gt;
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>Contact: &lt;sip:192.168.80.11:50555;ob&gt;
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>Call-ID: 23ccb54af191467ab6bceb00814a5a43
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>CSeq: 13513 INVITE
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>Supported: replaces, 100rel, timer, norefersub
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>Session-Expires: 1800
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>Min-SE: 90
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>User-Agent: MicroSIP/3.21.3
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>Content-Type: application/sdp
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>Content-Length:   346
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>v=0
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>o=- 3903069636 3903069636 IN IP4 192.168.71.146
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>s=pjmedia
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>b=AS:84
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>t=0 0
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>a=X-nat:1
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>m=audio 4022 RTP/AVP 8 0 101
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>c=IN IP4 192.168.71.146
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>b=TIAS:64000
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>a=rtcp:4023 IN IP4 192.168.71.146
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>a=sendrecv
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>a=rtpmap:8 PCMA/8000
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>a=rtpmap:0 PCMU/8000
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a>a=rtpmap:101 telephone-event/8000
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a>a=fmtp:101 0-16
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a>a=ssrc:1230049490 cname:10e14846533a1224
</span><span id="__span-22-34"><a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a>
</span><span id="__span-22-35"><a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a>Sep  7 06:57:10.746: //-1/xxxxxxxxxxxx/SIP/Msg/ccsipDisplayMsg:
</span><span id="__span-22-36"><a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a>Received:
</span><span id="__span-22-37"><a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a>INVITE sip:1@192.168.80.254 SIP/2.0
</span><span id="__span-22-38"><a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a>Via: SIP/2.0/UDP 192.168.71.146:50555;rport;branch=z9hG4bKPj4c1fe50f616945f5b4b9c4a4103efcec
</span><span id="__span-22-39"><a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a>Max-Forwards: 70
</span><span id="__span-22-40"><a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a>From: &lt;sip:31.145.1.90&gt;;tag=3b1d7dd63c2e42238a89541c88118e5d
</span><span id="__span-22-41"><a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a>To: &lt;sip:1@192.168.80.254&gt;
</span><span id="__span-22-42"><a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a>Contact: &lt;sip:192.168.80.11:50555;ob&gt;
</span><span id="__span-22-43"><a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a>Call-ID: 23ccb54af191467ab6bceb00814a5a43
</span><span id="__span-22-44"><a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a>CSeq: 13513 INVITE
</span><span id="__span-22-45"><a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a>Allow: PRACK, INVITE, ACK, BYE, CANCEL, UPDATE, INFO, SUBSCRIBE, NOTIFY, REFER, MESSAGE, OPTIONS
</span><span id="__span-22-46"><a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a>Supported: replaces, 100rel, timer, norefersub
</span><span id="__span-22-47"><a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a>Session-Expires: 1800
</span><span id="__span-22-48"><a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a>Min-SE: 90
</span><span id="__span-22-49"><a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a>User-Agent: MicroSIP/3.21.3
</span><span id="__span-22-50"><a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a>Content-Type: application/sdp
</span><span id="__span-22-51"><a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a>Content-Length:   346
</span><span id="__span-22-52"><a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a>
</span><span id="__span-22-53"><a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a>v=0
</span><span id="__span-22-54"><a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a>o=- 3903069636 3903069636 IN IP4 192.168.71.146
</span><span id="__span-22-55"><a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a>s=pjmedia
</span><span id="__span-22-56"><a id="__codelineno-22-56" name="__codelineno-22-56" href="#__codelineno-22-56"></a>b=AS:84
</span><span id="__span-22-57"><a id="__codelineno-22-57" name="__codelineno-22-57" href="#__codelineno-22-57"></a>t=0 0
</span><span id="__span-22-58"><a id="__codelineno-22-58" name="__codelineno-22-58" href="#__codelineno-22-58"></a>a=X-nat:1
</span><span id="__span-22-59"><a id="__codelineno-22-59" name="__codelineno-22-59" href="#__codelineno-22-59"></a>m=audio 4022 RTP/AVP 8 0 101
</span><span id="__span-22-60"><a id="__codelineno-22-60" name="__codelineno-22-60" href="#__codelineno-22-60"></a>c=IN IP4 192.168.71.146
</span><span id="__span-22-61"><a id="__codelineno-22-61" name="__codelineno-22-61" href="#__codelineno-22-61"></a>b=TIAS:64000
</span><span id="__span-22-62"><a id="__codelineno-22-62" name="__codelineno-22-62" href="#__codelineno-22-62"></a>a=rtcp:4023 IN IP4 192.168.71.146
</span><span id="__span-22-63"><a id="__codelineno-22-63" name="__codelineno-22-63" href="#__codelineno-22-63"></a>a=sendrecv
</span><span id="__span-22-64"><a id="__codelineno-22-64" name="__codelineno-22-64" href="#__codelineno-22-64"></a>a=rtpmap:8 PCMA/8000
</span><span id="__span-22-65"><a id="__codelineno-22-65" name="__codelineno-22-65" href="#__codelineno-22-65"></a>a=rtpmap:0 PCMU/8000
</span><span id="__span-22-66"><a id="__codelineno-22-66" name="__codelineno-22-66" href="#__codelineno-22-66"></a>a=rtpmap:101 telephone-event/8000
</span><span id="__span-22-67"><a id="__codelineno-22-67" name="__codelineno-22-67" href="#__codelineno-22-67"></a>a=fmtp:101 0-16
</span><span id="__span-22-68"><a id="__codelineno-22-68" name="__codelineno-22-68" href="#__codelineno-22-68"></a>a=ssrc:1230049490 cname:10e14846533a1224
</span><span id="__span-22-69"><a id="__codelineno-22-69" name="__codelineno-22-69" href="#__codelineno-22-69"></a>
</span><span id="__span-22-70"><a id="__codelineno-22-70" name="__codelineno-22-70" href="#__codelineno-22-70"></a>Sep  7 06:57:11.746: //-1/xxxxxxxxxxxx/SIP/Msg/ccsipDisplayMsg:
</span></code></pre></div>
<p><a class="glightbox" href="../images/2023-09-07-10-03-16.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-07-10-03-16.png" /></a></p>
<p>there are only <code>invite</code>. There is no redirection lets configure it to another MicroSIP device on workstation-2</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>dial-peer voice 1001 voip              --&gt; this is another virtual gate
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a> destination-pattern 1                 --&gt; this gate for specific destination &#39;1&#39;
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a> session protocol sipv2                --&gt; it is sip 
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a> session target ipv4:192.168.80.12     --&gt; when match the destination pattern redirect call to this address
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a> codec g711ulaw                        --&gt; use this codec
</span></code></pre></div>
now it is ok</p>
<p><a class="glightbox" href="../images/2023-09-07-10-23-55.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-07-10-23-55.png" /></a></p>
<p>we can see active call from gateway with <code>show cube calls</code></p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>CUBE-A#show cube calls
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>SIP call leg info:
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>=============================================================
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>Total SIP call legs:2, User Agent Client:1, User Agent Server:1
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>SIP UAC CALL INFO
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>No.  CallId    Calling#       Called#        RmtSignalIP                                  RmtMediaIP
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>     dstCallId SIPState       SIPSubState
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>========================================================================================================================================
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>1    4                        1              192.168.80.12                                192.168.80.12
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>     3         STATE_ACTIVE   SUBSTATE_NONE
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>   Number of SIP User Agent Client(UAC) calls: 1
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>SIP UAS CALL INFO
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>No.  CallId    Calling#       Called#        RmtSignalIP                                  RmtMediaIP
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>     dstCallId SIPState       SIPSubState
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>========================================================================================================================================
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>1    3                        1              192.168.80.11                                192.168.71.146
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>     4         STATE_ACTIVE   SUBSTATE_NONE
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>   Number of SIP User Agent Server(UAS) calls: 1
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>show call active voice: a total of 2 audio call-legs
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>=============================================================
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>Telephony call-legs: 0
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>SIP call-legs: 2
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>H323 call-legs: 0
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>Call agent controlled call-legs: 0
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>SCCP call-legs: 0
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>STCAPP call-legs: 0
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>Multicast call-legs: 0
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>Total call-legs: 2
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a> show voip rtp connection:
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a> =============================================================
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>VoIP RTP Port Usage Information:
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a>Max Ports Available: 19999, Ports Reserved: 101, Ports in Use: 2
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a>Port range not configured
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a>                                        Min   Max   Ports     Ports     Ports
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a>Media-Address Range                     Port  Port  Available Reserved  In-use
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a>------------------------------------------------------------------------------
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a>Global Media Pool                       8000  48198 19999     101       2
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a>------------------------------------------------------------------------------
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a>VoIP RTP active connections :
</span><span id="__span-24-47"><a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a>No. CallId     dstCallId  LocalRTP RmtRTP   LocalIP                                     RemoteIP                                  MPSS  VRF
</span><span id="__span-24-48"><a id="__codelineno-24-48" name="__codelineno-24-48" href="#__codelineno-24-48"></a>1     3          4          8004     4008     2.2.2.2                                   192.168.71.146                            NO    NA
</span><span id="__span-24-49"><a id="__codelineno-24-49" name="__codelineno-24-49" href="#__codelineno-24-49"></a>2     4          3          8006     4008     192.168.80.254                            192.168.80.12                             NO    NA
</span><span id="__span-24-50"><a id="__codelineno-24-50" name="__codelineno-24-50" href="#__codelineno-24-50"></a>Found 2 active RTP connections
</span><span id="__span-24-51"><a id="__codelineno-24-51" name="__codelineno-24-51" href="#__codelineno-24-51"></a>Number of Calls : 1
</span><span id="__span-24-52"><a id="__codelineno-24-52" name="__codelineno-24-52" href="#__codelineno-24-52"></a>---------- ---------- ---------- ----------- --------------- ---------------
</span><span id="__span-24-53"><a id="__codelineno-24-53" name="__codelineno-24-53" href="#__codelineno-24-53"></a>    confID correlator    AcallID     BcallID           state           event
</span><span id="__span-24-54"><a id="__codelineno-24-54" name="__codelineno-24-54" href="#__codelineno-24-54"></a>---------- ---------- ---------- ----------- --------------- ---------------
</span><span id="__span-24-55"><a id="__codelineno-24-55" name="__codelineno-24-55" href="#__codelineno-24-55"></a>         1          1          3          4       ALLOCATED DETAIL_STAT_RSP
</span></code></pre></div>
You dont have to choose a codec, if you dont know the codec you can use a group of codec that we called this <code>codec class</code></p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>voice class codec 100
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a> codec preference 1 g711ulaw
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a> codec preference 2 g711alaw
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a> codec preference 3 g729r8
</span></code></pre></div>
then we should use this codec class in to dial-peer</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>dial-peer voice 1000 voip
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a> voice-class codec 100
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>!
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>dial-peer voice 1001 voip
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a> voice-class codec 100
</span></code></pre></div>
this means, i prefer g711ulaw firstly then g711alaw and g729r8</p>
<p>We configured SIP OPTION on cucm. We can do same thing on IOS device like below:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>!Configuring the SIP Keepalive Group
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>voice class sip-options-keepalive 10
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>up-interval 60
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>retry 5
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>!Configuring an outbound SIP Dial Peer
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>dial-peer voice 1001 voip
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>voice-class sip options-keepalive profile 10
</span></code></pre></div>
<p><a class="glightbox" href="../images/2023-09-07-12-23-31.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-07-12-23-31.png" /></a></p>
<p>On the other hand we can modify sip packet on cisco ios with <code>sip profile</code> or cucm with <code>sip normalization</code>. Lets test on our topology</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>voice class sip-profiles 2
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a> request ANY sip-header User-Agent modify &quot;Cisco-SIPGateway/IOS-17.4.1a&quot; &quot;ilker MANSUR&quot;
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a> response ANY sip-header User-Agent modify &quot;Cisco-SIPGateway/IOS-17.4.1a&quot; &quot;ilker MANSUR&quot;
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>!
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>voice service voip
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a> sip
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>  sip-profile 2
</span></code></pre></div>
or you can use this into dial-peer</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>dial-peer voice 1001 voip
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a> voice-class sip profiles 2
</span></code></pre></div>
<p><a class="glightbox" href="../images/2023-09-07-13-32-53.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-07-13-32-53.png" /></a></p>
<p>sometimes you need to capture from IOS Device. For this operation</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>ip access-list standard CUBE
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a> 10 permit 192.168.80.254
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a> 20 deny   any
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>!
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>monitor capture ioslog access-list CUBE interface gigabitEthernet 1 both start
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>monitor capture ioslog stop
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>!
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>conf t
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>ip ftp username &lt;username&gt;
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>ip ftp password &lt;password&gt;
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>!
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>monitor capture ioslog export ftp://192.168.80.11/ioslog.pcap
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>or 
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>CUBE-A#show monitor capture ioslog buffer brief
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a> ----------------------------------------------------------------------------
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a> #   size   timestamp     source             destination      dscp    protocol
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a> ----------------------------------------------------------------------------
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>   0   63    0.000000   192.168.80.254   -&gt;  192.168.80.11    48 CS6  TCP
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>   1   54    1.827020   192.168.80.254   -&gt;  192.168.80.11    0  BE   TCP
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>   2  445    2.971010   192.168.80.254   -&gt;  192.168.80.12    26 AF31 UDP
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>   3   63    7.799962   192.168.80.254   -&gt;  192.168.80.11    48 CS6  TCP
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>   4   81   15.347989   192.168.80.254   -&gt;  255.255.255.255  0  BE   UDP
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>   5   81   19.347989   192.168.80.254   -&gt;  255.255.255.255  0  BE   UDP
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>   6   54   20.522983   192.168.80.254   -&gt;  192.168.80.11    0  BE   TCP
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>   7   90   22.187994   192.168.80.254   -&gt;  192.168.80.100   48 CS6  UDP
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a>   8   90   24.187994   192.168.80.254   -&gt;  192.168.80.100   48 CS6  UDP
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a>   9   55   26.157996   192.168.80.254   -&gt;  192.168.80.11    48 CS6  TCP
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a>  10   90   26.187994   192.168.80.254   -&gt;  192.168.80.100   48 CS6  UDP
</span></code></pre></div>
signalling is in .pcap but RTP not WHY?</p>
<p><a class="glightbox" href="../images/2023-09-07-15-57-52.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-07-15-57-52.png" /></a></p>
<p>There is a concept here <code>media flow around</code> or <code>media flow through</code></p>
<p><a class="glightbox" href="../images/2023-09-07-16-25-23.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-07-16-25-23.png" /></a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>! under dial-peer
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>dial-peer voice 1 voip
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>media flow-through/flow-around
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>! or as a service parameter
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>voice service voip
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>media flow-through/flow-around
</span></code></pre></div>
<p>Virtual cube do not support media flow-through because we need media resource as MTP feature.</p>
<h2 id="nat-in-sip">NAT in SIP</h2>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>Source:192.168.80.11:1525                 Source:182.178.80.11:17255
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>Destination:165.122.44.21:5060            Destination:165.122.44.21:5060
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>┌────────────────────────────┐            ┌─────────────────────────────┐
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>│                            │            │                             │
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>│    Local SIP Device        ├────────────►            NAT              │
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>│                            │            │                             │
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>└────────────────────────────┘            └─────────────────────────────┘
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>                                                   NAT Router
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>                                                  NAT Binding
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>                          Source:192.168.80.11:1525 &lt;────────&gt; Source:182.178.80.11:17255
</span></code></pre></div>
<p>NAT (Network Address Translation) is a network configuration technique that can introduce challenges, especially in the context of VoIP (Voice over IP) and SIP (Session Initiation Protocol) traffic. Here are the reasons explaining why NAT can create problems for SIP traffic and some tips on how to address these issues:</p>
<p><strong>Reasons</strong>:</p>
<ol>
<li>
<p><strong>IP Address Translation</strong>: NAT associates the IP addresses of devices within an internal network with a single external public IP address. This can lead to the translation of source and destination IP addresses in SIP traffic, causing routing issues.</p>
</li>
<li>
<p><strong>Port Mapping</strong>: NAT uses port mapping to distinguish between devices sharing the same public IP address. If port mapping is not properly configured or if it is misconfigured, incoming SIP traffic may not be correctly routed.</p>
</li>
<li>
<p><strong>Signaling Issues</strong>: NAT can introduce problems in the transmission of SIP signaling messages, such as call setup or termination. This can hinder the initiation or termination of calls.</p>
</li>
<li>
<p><strong>Voice Quality</strong>: SIP traffic includes not only signaling but also voice traffic. NAT may interfere with the proper transmission or introduce delays in voice packets, resulting in voice quality issues.</p>
</li>
<li>
<p><strong>Symmetric NAT</strong>: Some NAT types do not map incoming and outgoing traffic using the same port numbers. This can further complicate the correct routing of SIP traffic.</p>
</li>
</ol>
<p><strong>Solution Tips</strong>:</p>
<ol>
<li><strong>STUN (Session Traversal Utilities for NAT)</strong>: STUN servers can help you determine the real IP addresses and port numbers behind NAT devices. SIP clients can use STUN servers to discover the IP addresses and port numbers behind NAT.</li>
</ol>
<p>Lets check in MicroSIP</p>
<p><a class="glightbox" href="../images/2023-09-04-16-36-58.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-16-36-58.png" /></a>
<a class="glightbox" href="../images/2023-09-04-16-37-50.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/2023-09-04-16-37-50.png" /></a></p>
<ol>
<li>
<p><strong>ICE (Interactive Connectivity Establishment)</strong>: ICE is a protocol designed for NAT traversal and can automatically detect and bypass NAT devices. ICE provides a reliable solution for SIP communication.</p>
</li>
<li>
<p><strong>TURN (Traversal Using Relays around NAT)</strong>: A TURN (Traversal Using Relays around NAT) server is often used in conjunction with SIP (Session Initiation Protocol) to facilitate communication when devices are behind NAT (Network Address Translation) and firewall barriers. Here's how a TURN server works in the context of SIP. A TURN server acts as a relay for SIP signaling and media traffic when NAT or firewall barriers prevent direct communication between SIP devices. It allocates public IP addresses and ports, facilitating the flow of data between devices, and enables end-to-end communication despite network address translation and firewall restrictions.</p>
</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 ilkermansur
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/ilker-mansur-1514b969/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93zM6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>